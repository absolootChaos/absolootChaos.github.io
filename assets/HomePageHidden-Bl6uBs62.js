import{d as se,r as C,c as h,a as i,b as e,t as a,j as K,f as x,n as q,F as D,e as j,o as d,_ as ae,g as ce,h as re,i as pe,p as J}from"./index-Da2AKEMB.js";const ue={class:"lb-wrap"},me={class:"lb-header"},ve={class:"lb-title"},he={class:"lb-sub"},_e={key:0},fe={key:1},ge={key:2},be={key:0},ke={class:"lb-controls"},ye=["onClick"],Me={class:"table-wrap"},Ie={class:"lb-table"},Se={class:"col-points"},we={class:"col-points"},Te={key:0},xe={class:"cell-rank"},De={class:"cell-team"},Ne={class:"team-name"},Pe={class:"cell-players"},$e={class:"players"},Ce={class:"player"},Ke={class:"pname"},Fe=["href"],Re={class:"player"},Be={class:"pname"},Oe=["href"],We={class:"cell-points"},Ae={class:"points-pill"},Le={class:"cell-stat"},Ee={class:"cell-stat"},Ve={class:"cell-time"},je={class:"cell-actions"},He=["onClick"],Ge={key:0,class:"details"},ze={colspan:"8"},Xe={class:"details-card"},Ye={class:"details-table-wrap"},Ue={class:"mini grouped"},qe={class:"ghead"},Je={class:"grp p1",colspan:"3"},Qe={class:"grp-title"},Ze={class:"grp-name"},et={class:"grp p2",colspan:"3"},tt={class:"grp-title"},st={class:"grp-name"},at={class:"chead"},nt={class:"col-pts"},lt={class:"race"},ot={class:"p1 time"},it={class:"p1 stat"},dt={class:"p1 stat"},ct={class:"p2 time"},rt={class:"p2 stat"},pt={class:"p2 stat"},ut={class:"team time"},mt={class:"team stat"},vt={class:"team stat"},ht={class:"team rank"},_t={class:"team pts"},ft={class:"legend"},gt={key:0,class:"leg-item"},bt={key:1,class:"leg-item"},kt={key:2,class:"leg-item"},yt={key:0},Mt={key:1},It={class:"cell-rank"},St={class:"cell-team"},wt={class:"team-name"},Tt={class:"cell-players"},xt={key:0,class:"players"},Dt={class:"player"},Nt={class:"pname"},Pt=["href"],$t={class:"player"},Ct={class:"pname"},Kt=["href"],Ft={key:1,class:"players"},Rt={class:"cell-time"},Bt={class:"cell-points"},Ot={class:"points-pill"},Wt={class:"cell-stat"},At={class:"cell-stat"},Lt=se({__name:"LeaderboardRaceCard",props:{teams:{},raceOrder:{},includeMissingAsLast:{type:Boolean},scoringMode:{},pointsTable:{},decimals:{},percentileMin:{},percentileMax:{},gapMin:{},gapMax:{},gapWindowSeconds:{},gapWindowMode:{}},setup(Z){const m=Z,f=C({kind:"combined"}),w=C(null);function R(n){w.value=w.value===n?null:n}const b=h(()=>m.scoringMode??"table"),B=h(()=>m.includeMissingAsLast??!0),O=h(()=>m.pointsTable??[25,18,15,12,10,8,6,4,2,1]),W=h(()=>typeof m.decimals=="number"?Math.max(0,Math.floor(m.decimals)):0),A=h(()=>typeof m.percentileMin=="number"?m.percentileMin:25),L=h(()=>typeof m.percentileMax=="number"?m.percentileMax:100),H=h(()=>typeof m.gapMin=="number"?m.gapMin:1),G=h(()=>typeof m.gapMax=="number"?m.gapMax:25),g=h(()=>{const n=m.gapWindowSeconds;return typeof n=="number"&&isFinite(n)&&n>0?n:120}),l=h(()=>m.gapWindowMode??"max"),k=h(()=>m.raceOrder?.length?m.raceOrder:(m.teams[0]?.races??[]).map((s,v)=>({raceId:s.raceId,label:s.label??`Race ${v+1}`}))),F=h(()=>f.value.kind==="race"?f.value.raceId:null),X=h(()=>b.value==="table"?"Points":b.value==="percentile"?"Percentile":"Gap Pts"),ne=h(()=>{const n=b.value==="table"?"Points":b.value==="percentile"?"Percentile Points":"Gap Points";return F.value?`Team Leaderboard â€” ${k.value.find(s=>s.raceId===F.value)?.label??"Race"}`:`Team Leaderboard â€” Combined ${n}`}),N=h(()=>{const n=new Map;for(const t of m.teams)n.set(t.id,t);return n});function Y(n,t,s){return Math.max(t,Math.min(s,n))}function ee(n,t){const s=Math.pow(10,t);return Math.round(n*s)/s}function U(n){if(!isFinite(n))return"0";const t=W.value;return t>0?n.toFixed(t):String(Math.round(n))}function T(n){if(!n)return null;const t=n.trim();return t?t.startsWith("http://")||t.startsWith("https://")?t:`https://twitch.tv/${t.replace(/^@/,"")}`:null}function E(n){if(n==null||!isFinite(n))return"â€”";const t=Math.max(0,Math.floor(n)),s=Math.floor(t/3600),v=Math.floor(t%3600/60),p=t%60;return s>0?`${s}:${String(v).padStart(2,"0")}:${String(p).padStart(2,"0")}`:`${v}:${String(p).padStart(2,"0")}`}function V(n){return typeof n=="number"&&isFinite(n)}function z(n){return typeof n=="number"&&isFinite(n)?Math.max(0,Math.floor(n)):0}function le(n){if(n.status==="DNF"||n.status==="DNS")return null;if(V(n.teamSeconds))return n.teamSeconds;const t=n.player1Seconds,s=n.player2Seconds,v=V(t),p=V(s);return v&&p?t+s:v?t:p?s:null}function te(n){const t=m.teams.map(o=>{const c=o.races.find(S=>S.raceId===n),_=c?.player1Seconds,u=c?.player2Seconds,r=z(c?.player1Kills),I=z(c?.player2Kills),M=z(c?.player1Deaths),P=z(c?.player2Deaths);return{teamId:o.id,teamName:o.teamName,p1Seconds:V(_)?_:null,p2Seconds:V(u)?u:null,teamSeconds:c?le(c):null,p1Kills:r,p2Kills:I,teamKills:r+I,p1Deaths:M,p2Deaths:P,teamDeaths:M+P,rank:null,points:0}}),s=t.filter(o=>o.teamSeconds!=null).map(o=>({...o,teamSeconds:o.teamSeconds}));s.sort((o,c)=>o.teamSeconds-c.teamSeconds);const v=new Map,p=new Map,y=s.length;if(y>0)if(s.forEach((o,c)=>v.set(o.teamId,c+1)),b.value==="table")s.forEach((o,c)=>p.set(o.teamId,O.value[c]??0));else if(b.value==="percentile"){const o=Y(A.value,0,100),c=Y(L.value,0,100),_=Math.min(o,c),u=Math.max(o,c);let r=0;for(;r<y;){const I=s[r].teamSeconds;let M=r;for(;M+1<y&&s[M+1].teamSeconds===I;)M++;const P=(r+M)/2;let S;if(y===1)S=u;else{const $=(y-1-P)/(y-1);S=_+$*(u-_)}S=ee(S,W.value);for(let $=r;$<=M;$++)p.set(s[$].teamId,S);r=M+1}}else{const o=H.value,c=G.value,_=s[0].teamSeconds,u=s[y-1].teamSeconds,r=Math.max(1,u-_),I=g.value,M=l.value==="fixed"?I:l.value==="auto"?r:Math.max(I,r);for(const P of s){const S=Math.max(0,P.teamSeconds-_),$=Y(S/M,0,1),de=ee(c-$*(c-o),W.value);p.set(P.teamId,de)}}if(B.value){const o=t.filter(_=>_.teamSeconds==null),c=s.length;o.forEach((_,u)=>v.set(_.teamId,c+u+1))}return t.map(o=>({...o,rank:v.get(o.teamId)??null,points:p.get(o.teamId)??0})).sort((o,c)=>{const _=o.rank??Number.POSITIVE_INFINITY,u=c.rank??Number.POSITIVE_INFINITY;return _!==u?_-u:o.teamName.localeCompare(c.teamName)})}const oe=h(()=>{const n=new Map;for(const s of k.value)n.set(s.raceId,te(s.raceId));return m.teams.map(s=>{const v=k.value.map(u=>{const r=(n.get(u.raceId)??[]).find(I=>I.teamId===s.id);return{raceId:u.raceId,label:u.label,p1Seconds:r?.p1Seconds??null,p2Seconds:r?.p2Seconds??null,teamSeconds:r?.teamSeconds??null,p1Kills:r?.p1Kills??0,p2Kills:r?.p2Kills??0,teamKills:r?.teamKills??0,p1Deaths:r?.p1Deaths??0,p2Deaths:r?.p2Deaths??0,teamDeaths:r?.teamDeaths??0,rank:r?.rank??null,points:r?.points??0}}),p=v.reduce((u,r)=>u+r.points,0),y=v.reduce((u,r)=>u+r.teamKills,0),o=v.reduce((u,r)=>u+r.teamDeaths,0),c=v.map(u=>u.teamSeconds).filter(u=>u!=null&&isFinite(u)),_=c.length?c.reduce((u,r)=>u+r,0):null;return{teamId:s.id,teamName:s.teamName,player1:s.player1,player2:s.player2,totalPoints:p,totalTeamSeconds:_,totalTeamKills:y,totalTeamDeaths:o,raceBreakdown:v}}).sort((s,v)=>{if(v.totalPoints!==s.totalPoints)return v.totalPoints-s.totalPoints;const p=s.raceBreakdown.reduce((o,c)=>o+(c.rank??9999),0)/Math.max(1,s.raceBreakdown.length),y=v.raceBreakdown.reduce((o,c)=>o+(c.rank??9999),0)/Math.max(1,v.raceBreakdown.length);return p!==y?p-y:s.teamName.localeCompare(v.teamName)})}),ie=h(()=>F.value?te(F.value):[]);return(n,t)=>(d(),i("div",ue,[e("header",me,[e("div",ve,[e("h2",null,a(ne.value),1),e("p",he,[t[2]||(t[2]=K(" Per race: team time = P1 + P2. ",-1)),b.value==="table"?(d(),i("span",_e,"F1 points table by finish.")):b.value==="percentile"?(d(),i("span",fe," Position percentile mapped to "+a(A.value)+"â€“"+a(L.value)+" (ties share score). ",1)):(d(),i("span",ge,[K(" Gap scoring vs best time: "+a(H.value)+"â€“"+a(G.value)+". Window mode: ",1),e("b",null,a(l.value),1),l.value!=="auto"?(d(),i("span",be," (fixed="+a(g.value)+"s)",1)):x("",!0),t[1]||(t[1]=K(". ",-1))]))])]),e("div",ke,[e("button",{class:q(["chip",{active:f.value.kind==="combined"}]),onClick:t[0]||(t[0]=s=>f.value={kind:"combined"})}," Combined ",2),(d(!0),i(D,null,j(k.value,s=>(d(),i("button",{key:s.raceId,class:q(["chip",{active:f.value.kind==="race"&&f.value.raceId===s.raceId}]),onClick:v=>f.value={kind:"race",raceId:s.raceId}},a(s.label),11,ye))),128))])]),e("div",Me,[e("table",Ie,[e("thead",null,[e("tr",null,[t[9]||(t[9]=e("th",{class:"col-rank"},"#",-1)),t[10]||(t[10]=e("th",{class:"col-team"},"Team",-1)),t[11]||(t[11]=e("th",{class:"col-players"},"Players",-1)),f.value.kind==="combined"?(d(),i(D,{key:0},[e("th",Se,a(X.value),1),t[3]||(t[3]=e("th",{class:"col-stat"},"Team Checks",-1)),t[4]||(t[4]=e("th",{class:"col-stat"},"Team Deaths",-1)),t[5]||(t[5]=e("th",{class:"col-time"},"Total Time",-1))],64)):(d(),i(D,{key:1},[t[6]||(t[6]=e("th",{class:"col-time"},"Team Time",-1)),e("th",we,a(X.value),1),t[7]||(t[7]=e("th",{class:"col-stat"},"Team Checks",-1)),t[8]||(t[8]=e("th",{class:"col-stat"},"Team Deaths",-1))],64)),t[12]||(t[12]=e("th",{class:"col-actions"},null,-1))])]),f.value.kind==="combined"?(d(),i("tbody",Te,[(d(!0),i(D,null,j(oe.value,(s,v)=>(d(),i(D,{key:s.teamId},[e("tr",{class:q(["row",{expanded:w.value===s.teamId}])},[e("td",xe,a(v+1),1),e("td",De,[e("div",Ne,a(s.teamName),1)]),e("td",Pe,[e("div",$e,[e("div",Ce,[e("span",Ke,a(s.player1.name),1),T(s.player1.twitch)?(d(),i("a",{key:0,class:"twitch",href:T(s.player1.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,Fe)):x("",!0)]),e("div",Re,[e("span",Be,a(s.player2.name),1),T(s.player2.twitch)?(d(),i("a",{key:0,class:"twitch",href:T(s.player2.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,Oe)):x("",!0)])])]),e("td",We,[e("span",Ae,a(U(s.totalPoints)),1)]),e("td",Le,a(s.totalTeamKills),1),e("td",Ee,a(s.totalTeamDeaths),1),e("td",Ve,a(E(s.totalTeamSeconds)),1),e("td",je,[e("button",{class:"btn",onClick:p=>R(s.teamId)},a(w.value===s.teamId?"Hide":"Details"),9,He)])],2),w.value===s.teamId?(d(),i("tr",Ge,[e("td",ze,[e("div",Xe,[t[33]||(t[33]=e("div",{class:"details-head"},[e("div",{class:"dh-title"},"Race breakdown"),e("div",{class:"dh-sub"},"Shows per-player and team totals each race.")],-1)),e("div",Ye,[e("table",Ue,[e("thead",null,[e("tr",qe,[t[17]||(t[17]=e("th",{class:"col-race",rowspan:"2"},"Race",-1)),e("th",Je,[e("div",Qe,[t[13]||(t[13]=e("span",{class:"grp-dot p1"},null,-1)),e("span",Ze,a(s.player1.name),1),t[14]||(t[14]=e("span",{class:"grp-tag"},"P1",-1))])]),e("th",et,[e("div",tt,[t[15]||(t[15]=e("span",{class:"grp-dot p2"},null,-1)),e("span",st,a(s.player2.name),1),t[16]||(t[16]=e("span",{class:"grp-tag"},"P2",-1))])]),t[18]||(t[18]=e("th",{class:"grp team",colspan:"5"},[e("div",{class:"grp-title"},[e("span",{class:"grp-dot team"}),e("span",{class:"grp-name"},"Team")])],-1))]),e("tr",at,[t[19]||(t[19]=e("th",{class:"col-time"},"Time",-1)),t[20]||(t[20]=e("th",{class:"col-stat"},"Checks",-1)),t[21]||(t[21]=e("th",{class:"col-stat"},"Deaths",-1)),t[22]||(t[22]=e("th",{class:"col-time"},"Time",-1)),t[23]||(t[23]=e("th",{class:"col-stat"},"Checks",-1)),t[24]||(t[24]=e("th",{class:"col-stat"},"Deaths",-1)),t[25]||(t[25]=e("th",{class:"col-time"},"Time",-1)),t[26]||(t[26]=e("th",{class:"col-stat"},"Checks",-1)),t[27]||(t[27]=e("th",{class:"col-stat"},"Deaths",-1)),t[28]||(t[28]=e("th",{class:"col-rank"},"Rank",-1)),e("th",nt,a(X.value),1)])]),e("tbody",null,[(d(!0),i(D,null,j(s.raceBreakdown,p=>(d(),i("tr",{key:p.raceId,class:"rrow"},[e("td",lt,a(p.label),1),e("td",ot,a(E(p.p1Seconds)),1),e("td",it,a(p.p1Kills),1),e("td",dt,a(p.p1Deaths),1),e("td",ct,a(E(p.p2Seconds)),1),e("td",rt,a(p.p2Kills),1),e("td",pt,a(p.p2Deaths),1),e("td",ut,[e("b",null,a(E(p.teamSeconds)),1)]),e("td",mt,[e("b",null,a(p.teamKills),1)]),e("td",vt,[e("b",null,a(p.teamDeaths),1)]),e("td",ht,a(p.rank??"â€”"),1),e("td",_t,[e("b",null,a(U(p.points)),1)])]))),128))])])]),e("div",ft,[t[32]||(t[32]=e("div",{class:"leg-item"},[e("span",{class:"dot"}),e("span",null,"Missing/DNF times score 0")],-1)),b.value==="table"?(d(),i("div",gt,[t[29]||(t[29]=e("span",{class:"dot"},null,-1)),e("span",null,"Points table: "+a(O.value.join(", ")),1)])):b.value==="percentile"?(d(),i("div",bt,[t[30]||(t[30]=e("span",{class:"dot"},null,-1)),e("span",null,"Percentile range: "+a(A.value)+"â€“"+a(L.value)+" (ties share score)",1)])):(d(),i("div",kt,[t[31]||(t[31]=e("span",{class:"dot"},null,-1)),e("span",null,[K(" Gap vs best time. Window mode: "+a(l.value)+" ",1),l.value!=="auto"?(d(),i("span",yt," (fixed="+a(g.value)+"s)",1)):x("",!0)])]))])])])])):x("",!0)],64))),128))])):(d(),i("tbody",Mt,[(d(!0),i(D,null,j(ie.value,s=>(d(),i("tr",{key:s.teamId,class:"row"},[e("td",It,a(s.rank??"â€”"),1),e("td",St,[e("div",wt,a(s.teamName),1)]),e("td",Tt,[N.value.get(s.teamId)?(d(),i("div",xt,[e("div",Dt,[e("span",Nt,a(N.value.get(s.teamId).player1.name),1),T(N.value.get(s.teamId).player1.twitch)?(d(),i("a",{key:0,class:"twitch",href:T(N.value.get(s.teamId).player1.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,Pt)):x("",!0)]),e("div",$t,[e("span",Ct,a(N.value.get(s.teamId).player2.name),1),T(N.value.get(s.teamId).player2.twitch)?(d(),i("a",{key:0,class:"twitch",href:T(N.value.get(s.teamId).player2.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,Kt)):x("",!0)])])):(d(),i("div",Ft,t[34]||(t[34]=[e("div",{class:"player"},[e("span",{class:"pname"},"â€”")],-1),e("div",{class:"player"},[e("span",{class:"pname"},"â€”")],-1)])))]),e("td",Rt,[e("b",null,a(E(s.teamSeconds)),1)]),e("td",Bt,[e("span",Ot,a(U(s.points)),1)]),e("td",Wt,a(s.teamKills),1),e("td",At,a(s.teamDeaths),1),t[35]||(t[35]=e("td",{class:"cell-actions"},null,-1))]))),128))]))])])]))}}),Q=ae(Lt,[["__scopeId","data-v-179097ac"]]),Et={class:"page"},Vt={class:"home"},jt={class:"topbar"},Ht={class:"top-actions"},Gt={class:"meta"},zt={class:"pill"},Xt={class:"pill"},Yt={key:0,class:"pill glow"},Ut={id:"leaderboard",class:"card"},qt={class:"card-body"},Jt={key:0,class:"scroll-safe"},Qt={key:1,class:"skeleton"},Zt={class:"sk-grid"},es=se({__name:"HomePageHidden",setup(Z){const m=C([]),f=C([]),w=C([]),R=C(null),b=C(new Date);let B=null;function O(g){const l=new Date(g);return Number.isNaN(l.getTime())?new Date(0):l}function W(g,l){return g===!0?!0:g===!1?!1:b.value.getTime()>=O(l).getTime()}function A(g){const l=O(g).getTime();return l===0?!1:b.value.getTime()>=l}const L=h(()=>{if(!R.value)return!1;for(const g of R.value.weeks||[])for(const l of g.seeds||[]){const k=W(l.releases.forceDownload,l.releases.downloadAt),F=!A(l.deadlineAt);if(k&&F)return!0}return!1}),H=h(()=>m.value?.length??0),G=h(()=>f.value?.length??0);return ce(async()=>{const[g,l]=await Promise.all([fetch("/data/teamsHidden.json",{cache:"no-store"}),fetch("/data/releases.json",{cache:"no-store"})]),k=await g.json();m.value=k.teams||[],f.value=k.races||[],w.value=k.pointsTable||[],R.value=await l.json(),B=window.setInterval(()=>b.value=new Date,1e3)}),re(()=>{B&&window.clearInterval(B)}),(g,l)=>(d(),i("div",Et,[e("div",Vt,[e("header",jt,[l[3]||(l[3]=pe('<div class="title" data-v-d1da9f72><div class="spark" data-v-d1da9f72>ğŸ</div><div class="title-text" data-v-d1da9f72><div class="h1" data-v-d1da9f72>Leaderboard</div><div class="sub" data-v-d1da9f72> Ranked by team time with F1-style points. Expand rows for per-race details. </div></div></div>',1)),e("div",Ht,[e("div",Gt,[e("span",zt,[l[0]||(l[0]=e("span",{class:"dot"},null,-1)),K(" "+a(H.value)+" teams ",1)]),e("span",Xt,[l[1]||(l[1]=e("span",{class:"dot dot2"},null,-1)),K(" "+a(G.value)+" races ",1)]),L.value?(d(),i("span",Yt,l[2]||(l[2]=[e("span",{class:"dot dot3"},null,-1),K(" Active seed live ",-1)]))):x("",!0)])])]),e("section",Ut,[l[7]||(l[7]=e("div",{class:"card-head"},[e("h2",null,"Overall Standings")],-1)),e("div",qt,[m.value.length?(d(),i("div",Jt,[J(Q,{teams:m.value,raceOrder:f.value,pointsTable:w.value},null,8,["teams","raceOrder","pointsTable"]),J(Q,{teams:m.value,raceOrder:f.value,scoringMode:"percentile",percentileMin:5,percentileMax:25,percentileDecimals:0},null,8,["teams","raceOrder"]),J(Q,{teams:m.value,raceOrder:f.value,scoringMode:"gap",gapMin:5,gapMax:25,gapWindowMode:"max",gapWindowSeconds:60,decimals:0},null,8,["teams","raceOrder"])])):(d(),i("div",Qt,[l[4]||(l[4]=e("div",{class:"sk-line w40"},null,-1)),l[5]||(l[5]=e("div",{class:"sk-line w70"},null,-1)),l[6]||(l[6]=e("div",{class:"sk-line w55"},null,-1)),e("div",Zt,[(d(),i(D,null,j(8,k=>e("div",{class:"sk-box",key:k})),64))])]))])])])]))}}),ss=ae(es,[["__scopeId","data-v-d1da9f72"]]);export{ss as default};
