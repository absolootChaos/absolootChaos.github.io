import{d as ae,r as C,c as _,a as u,b as e,t as n,j as K,f as D,n as Q,F as P,e as z,o as p,_ as ne,g as ue,h as pe,i as me,p as te}from"./index-BBqrp36J.js";const ve={class:"lb-wrap"},he={class:"lb-header"},_e={class:"lb-title"},fe={class:"lb-sub"},ge={key:0},be={key:1},ke={key:2},ye={key:0},Ie={class:"lb-controls"},Se=["onClick"],Me={class:"table-wrap"},we={class:"lb-table"},Te={class:"col-points"},xe={class:"col-points"},De={key:0},Pe={class:"cell-rank"},Ne={class:"cell-team"},$e={class:"team-name"},Ce={class:"cell-players"},Ke={class:"players"},We={class:"player"},Fe={class:"pname"},Re=["href"],Be={class:"player"},Ae={class:"pname"},Le=["href"],Oe={class:"cell-points"},Ee={class:"points-pill"},Ve={class:"cell-stat"},je={class:"cell-stat"},He={class:"cell-time"},Ge={class:"cell-actions"},ze=["onClick"],Xe={key:0,class:"details"},Ye={colspan:"8"},Ue={class:"details-card"},qe={class:"details-table-wrap"},Je={class:"mini grouped"},Qe={class:"ghead"},Ze={class:"grp p1",colspan:"3"},et={class:"grp-title"},tt={class:"grp-name"},st={class:"grp p2",colspan:"3"},at={class:"grp-title"},nt={class:"grp-name"},lt={class:"chead"},ot={class:"col-pts"},it={class:"race"},ct={class:"p1 time"},dt={class:"p1 stat"},rt={class:"p1 stat"},ut={class:"p2 time"},pt={class:"p2 stat"},mt={class:"p2 stat"},vt={class:"team time"},ht={class:"team stat"},_t={class:"team stat"},ft={class:"team rank"},gt={class:"team pts"},bt={class:"legend"},kt={key:0,class:"leg-item"},yt={key:1,class:"leg-item"},It={key:2,class:"leg-item"},St={key:0},Mt={key:1},wt={class:"cell-rank"},Tt={class:"cell-team"},xt={class:"team-name"},Dt={class:"cell-players"},Pt={key:0,class:"players"},Nt={class:"player"},$t={class:"pname"},Ct=["href"],Kt={class:"player"},Wt={class:"pname"},Ft=["href"],Rt={key:1,class:"players"},Bt={class:"cell-time"},At={class:"cell-points"},Lt={class:"points-pill"},Ot={class:"cell-stat"},Et={class:"cell-stat"},Vt=ae({__name:"LeaderboardRaceCard",props:{teams:{},raceOrder:{},includeMissingAsLast:{type:Boolean},scoringMode:{},pointsTable:{},decimals:{},percentileMin:{},percentileMax:{},gapMin:{},gapMax:{},gapWindowSeconds:{},gapWindowMode:{},closeWindowSeconds:{}},setup(Z){const v=Z,k=C({kind:"combined"}),T=C(null);function A(a){T.value=T.value===a?null:a}const f=_(()=>v.scoringMode??"table"),L=_(()=>v.includeMissingAsLast??!0),O=_(()=>v.pointsTable??[25,18,15,12,10,8,6,4,2,1]),W=_(()=>typeof v.decimals=="number"?Math.max(0,Math.floor(v.decimals)):0),F=_(()=>typeof v.percentileMin=="number"?v.percentileMin:25),R=_(()=>typeof v.percentileMax=="number"?v.percentileMax:100),E=_(()=>typeof v.gapMin=="number"?v.gapMin:1),V=_(()=>typeof v.gapMax=="number"?v.gapMax:25),b=_(()=>{const a=v.gapWindowSeconds;return typeof a=="number"&&isFinite(a)&&a>0?a:120}),i=_(()=>v.gapWindowMode??"max"),M=_(()=>{const a=v.closeWindowSeconds;return typeof a=="number"&&isFinite(a)&&a>=0?a:60}),B=_(()=>v.raceOrder?.length?v.raceOrder:(v.teams[0]?.races??[]).map((s,m)=>({raceId:s.raceId,label:s.label??`Race ${m+1}`}))),X=_(()=>k.value.kind==="race"?k.value.raceId:null),q=_(()=>f.value==="table"?"Points":f.value==="percentile"?"Percentile":"Gap Pts"),le=_(()=>{const a=f.value==="table"?"Points":f.value==="percentile"?"Percentile Points":"Gap Points";return X.value?`Team Leaderboard ‚Äî ${B.value.find(s=>s.raceId===X.value)?.label??"Race"}`:`Team Leaderboard ‚Äî Combined ${a}`}),N=_(()=>{const a=new Map;for(const t of v.teams)a.set(t.id,t);return a});function j(a,t,s){return Math.max(t,Math.min(s,a))}function Y(a,t){const s=Math.pow(10,t);return Math.round(a*s)/s}function J(a){if(!isFinite(a))return"0";const t=W.value;return t>0?a.toFixed(t):String(Math.round(a))}function x(a){if(!a)return null;const t=a.trim();return t?t.startsWith("http://")||t.startsWith("https://")?t:`https://twitch.tv/${t.replace(/^@/,"")}`:null}function H(a){if(a==null||!isFinite(a))return"‚Äî";const t=Math.max(0,Math.floor(a)),s=Math.floor(t/3600),m=Math.floor(t%3600/60),c=t%60;return s>0?`${s}:${String(m).padStart(2,"0")}:${String(c).padStart(2,"0")}`:`${m}:${String(c).padStart(2,"0")}`}function G(a){return typeof a=="number"&&isFinite(a)}function U(a){return typeof a=="number"&&isFinite(a)?Math.max(0,Math.floor(a)):0}function oe(a){if(a.status==="DNF"||a.status==="DNS")return null;if(G(a.teamSeconds))return a.teamSeconds;const t=a.player1Seconds,s=a.player2Seconds,m=G(t),c=G(s);return m&&c?t+s:m?t:c?s:null}function ie(a,t,s){const m=new Map,{minPts:c,maxPts:g,decimals:l,closeWindowSeconds:r}=s;for(let h=0;h<a.length;h++){const o=a[h],d=t.get(o.teamId)??c;if(h===0){m.set(o.teamId,Y(j(d,c,g),l));continue}const S=a[h-1],y=m.get(S.teamId)??g,w=o.teamSeconds-S.teamSeconds;let I;w<=r?I=y-1:I=Math.min(d,y-1),m.set(o.teamId,Y(j(I,c,g),l))}return m}function ee(a){const t=v.teams.map(l=>{const r=l.races.find(I=>I.raceId===a),h=r?.player1Seconds,o=r?.player2Seconds,d=U(r?.player1Kills),S=U(r?.player2Kills),y=U(r?.player1Deaths),w=U(r?.player2Deaths);return{teamId:l.id,teamName:l.teamName,p1Seconds:G(h)?h:null,p2Seconds:G(o)?o:null,teamSeconds:r?oe(r):null,p1Kills:d,p2Kills:S,teamKills:d+S,p1Deaths:y,p2Deaths:w,teamDeaths:y+w,rank:null,points:0}}),s=t.filter(l=>l.teamSeconds!=null).map(l=>({...l,teamSeconds:l.teamSeconds}));s.sort((l,r)=>l.teamSeconds-r.teamSeconds);const m=new Map,c=new Map,g=s.length;if(g>0){if(s.forEach((l,r)=>m.set(l.teamId,r+1)),f.value==="table")s.forEach((l,r)=>c.set(l.teamId,O.value[r]??0));else if(f.value==="percentile"){const l=j(F.value,0,999999),r=j(R.value,0,999999),h=Math.min(l,r),o=Math.max(l,r);let d=0;for(;d<g;){const S=s[d].teamSeconds;let y=d;for(;y+1<g&&s[y+1].teamSeconds===S;)y++;const w=(d+y)/2;let I;if(g===1)I=o;else{const $=(g-1-w)/(g-1);I=h+$*(o-h)}I=Y(I,W.value);for(let $=d;$<=y;$++)c.set(s[$].teamId,I);d=y+1}}else{const l=E.value,r=V.value,h=s[0].teamSeconds,o=s[g-1].teamSeconds,d=Math.max(1,o-h),S=b.value,y=i.value==="fixed"?S:i.value==="auto"?d:Math.max(S,d);for(const w of s){const I=Math.max(0,w.teamSeconds-h),$=j(I/y,0,1),re=Y(r-$*(r-l),W.value);c.set(w.teamId,re)}}if(f.value==="percentile"||f.value==="gap"){const l=f.value==="percentile"?Math.min(F.value,R.value):E.value,r=f.value==="percentile"?Math.max(F.value,R.value):V.value,h=ie(s.map(o=>({teamId:o.teamId,teamSeconds:o.teamSeconds})),c,{minPts:l,maxPts:r,decimals:W.value,closeWindowSeconds:M.value});c.clear();for(const[o,d]of h.entries())c.set(o,d)}}if(L.value){const l=t.filter(h=>h.teamSeconds==null),r=s.length;l.forEach((h,o)=>m.set(h.teamId,r+o+1))}return t.map(l=>({...l,rank:m.get(l.teamId)??null,points:c.get(l.teamId)??0})).sort((l,r)=>{const h=l.rank??Number.POSITIVE_INFINITY,o=r.rank??Number.POSITIVE_INFINITY;return h!==o?h-o:l.teamName.localeCompare(r.teamName)})}const ce=_(()=>{const a=new Map;for(const s of B.value)a.set(s.raceId,ee(s.raceId));return v.teams.map(s=>{const m=B.value.map(o=>{const d=(a.get(o.raceId)??[]).find(S=>S.teamId===s.id);return{raceId:o.raceId,label:o.label,p1Seconds:d?.p1Seconds??null,p2Seconds:d?.p2Seconds??null,teamSeconds:d?.teamSeconds??null,p1Kills:d?.p1Kills??0,p2Kills:d?.p2Kills??0,teamKills:d?.teamKills??0,p1Deaths:d?.p1Deaths??0,p2Deaths:d?.p2Deaths??0,teamDeaths:d?.teamDeaths??0,rank:d?.rank??null,points:d?.points??0}}),c=m.reduce((o,d)=>o+d.points,0),g=m.reduce((o,d)=>o+d.teamKills,0),l=m.reduce((o,d)=>o+d.teamDeaths,0),r=m.map(o=>o.teamSeconds).filter(o=>o!=null&&isFinite(o)),h=r.length?r.reduce((o,d)=>o+d,0):null;return{teamId:s.id,teamName:s.teamName,player1:s.player1,player2:s.player2,totalPoints:c,totalTeamSeconds:h,totalTeamKills:g,totalTeamDeaths:l,raceBreakdown:m}}).sort((s,m)=>{if(m.totalPoints!==s.totalPoints)return m.totalPoints-s.totalPoints;const c=s.raceBreakdown.reduce((l,r)=>l+(r.rank??9999),0)/Math.max(1,s.raceBreakdown.length),g=m.raceBreakdown.reduce((l,r)=>l+(r.rank??9999),0)/Math.max(1,m.raceBreakdown.length);return c!==g?c-g:s.teamName.localeCompare(m.teamName)})}),de=_(()=>X.value?ee(X.value):[]);return(a,t)=>(p(),u("div",ve,[e("header",he,[e("div",_e,[e("h2",null,n(le.value),1),e("p",fe,[t[2]||(t[2]=K(" Per race: team time = P1 + P2. ",-1)),f.value==="table"?(p(),u("span",ge,"F1 points table by finish.")):f.value==="percentile"?(p(),u("span",be," Position percentile ")):(p(),u("span",ke,[K(" Gap scoring vs best time: "+n(E.value)+"‚Äì"+n(V.value)+". Window mode: ",1),e("b",null,n(i.value),1),i.value!=="auto"?(p(),u("span",ye," (fixed="+n(b.value)+"s)",1)):D("",!0),t[1]||(t[1]=K(". ",-1))]))])]),e("div",Ie,[e("button",{class:Q(["chip",{active:k.value.kind==="combined"}]),onClick:t[0]||(t[0]=s=>k.value={kind:"combined"})}," Combined ",2),(p(!0),u(P,null,z(B.value,s=>(p(),u("button",{key:s.raceId,class:Q(["chip",{active:k.value.kind==="race"&&k.value.raceId===s.raceId}]),onClick:m=>k.value={kind:"race",raceId:s.raceId}},n(s.label),11,Se))),128))])]),e("div",Me,[e("table",we,[e("thead",null,[e("tr",null,[t[9]||(t[9]=e("th",{class:"col-rank"},"#",-1)),t[10]||(t[10]=e("th",{class:"col-team"},"Team",-1)),t[11]||(t[11]=e("th",{class:"col-players"},"Players",-1)),k.value.kind==="combined"?(p(),u(P,{key:0},[e("th",Te,n(q.value),1),t[3]||(t[3]=e("th",{class:"col-stat"},"Team Checks",-1)),t[4]||(t[4]=e("th",{class:"col-stat"},"Team Deaths",-1)),t[5]||(t[5]=e("th",{class:"col-time"},"Total Time",-1))],64)):(p(),u(P,{key:1},[t[6]||(t[6]=e("th",{class:"col-time"},"Team Time",-1)),e("th",xe,n(q.value),1),t[7]||(t[7]=e("th",{class:"col-stat"},"Team Checks",-1)),t[8]||(t[8]=e("th",{class:"col-stat"},"Team Deaths",-1))],64)),t[12]||(t[12]=e("th",{class:"col-actions"},null,-1))])]),k.value.kind==="combined"?(p(),u("tbody",De,[(p(!0),u(P,null,z(ce.value,(s,m)=>(p(),u(P,{key:s.teamId},[e("tr",{class:Q(["row",{expanded:T.value===s.teamId}])},[e("td",Pe,n(m+1),1),e("td",Ne,[e("div",$e,n(s.teamName),1)]),e("td",Ce,[e("div",Ke,[e("div",We,[e("span",Fe,n(s.player1.name),1),x(s.player1.twitch)?(p(),u("a",{key:0,class:"twitch",href:x(s.player1.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,Re)):D("",!0)]),e("div",Be,[e("span",Ae,n(s.player2.name),1),x(s.player2.twitch)?(p(),u("a",{key:0,class:"twitch",href:x(s.player2.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,Le)):D("",!0)])])]),e("td",Oe,[e("span",Ee,n(J(s.totalPoints)),1)]),e("td",Ve,n(s.totalTeamKills),1),e("td",je,n(s.totalTeamDeaths),1),e("td",He,n(H(s.totalTeamSeconds)),1),e("td",Ge,[e("button",{class:"btn",onClick:c=>A(s.teamId)},n(T.value===s.teamId?"Hide":"Details"),9,ze)])],2),T.value===s.teamId?(p(),u("tr",Xe,[e("td",Ye,[e("div",Ue,[t[33]||(t[33]=e("div",{class:"details-head"},[e("div",{class:"dh-title"},"Race breakdown"),e("div",{class:"dh-sub"},"Shows per-player and team totals each race.")],-1)),e("div",qe,[e("table",Je,[e("thead",null,[e("tr",Qe,[t[17]||(t[17]=e("th",{class:"col-race",rowspan:"2"},"Race",-1)),e("th",Ze,[e("div",et,[t[13]||(t[13]=e("span",{class:"grp-dot p1"},null,-1)),e("span",tt,n(s.player1.name),1),t[14]||(t[14]=e("span",{class:"grp-tag"},"P1",-1))])]),e("th",st,[e("div",at,[t[15]||(t[15]=e("span",{class:"grp-dot p2"},null,-1)),e("span",nt,n(s.player2.name),1),t[16]||(t[16]=e("span",{class:"grp-tag"},"P2",-1))])]),t[18]||(t[18]=e("th",{class:"grp team",colspan:"5"},[e("div",{class:"grp-title"},[e("span",{class:"grp-dot team"}),e("span",{class:"grp-name"},"Team")])],-1))]),e("tr",lt,[t[19]||(t[19]=e("th",{class:"col-time"},"Time",-1)),t[20]||(t[20]=e("th",{class:"col-stat"},"Checks",-1)),t[21]||(t[21]=e("th",{class:"col-stat"},"Deaths",-1)),t[22]||(t[22]=e("th",{class:"col-time"},"Time",-1)),t[23]||(t[23]=e("th",{class:"col-stat"},"Checks",-1)),t[24]||(t[24]=e("th",{class:"col-stat"},"Deaths",-1)),t[25]||(t[25]=e("th",{class:"col-time"},"Time",-1)),t[26]||(t[26]=e("th",{class:"col-stat"},"Checks",-1)),t[27]||(t[27]=e("th",{class:"col-stat"},"Deaths",-1)),t[28]||(t[28]=e("th",{class:"col-rank"},"Rank",-1)),e("th",ot,n(q.value),1)])]),e("tbody",null,[(p(!0),u(P,null,z(s.raceBreakdown,c=>(p(),u("tr",{key:c.raceId,class:"rrow"},[e("td",it,n(c.label),1),e("td",ct,n(H(c.p1Seconds)),1),e("td",dt,n(c.p1Kills),1),e("td",rt,n(c.p1Deaths),1),e("td",ut,n(H(c.p2Seconds)),1),e("td",pt,n(c.p2Kills),1),e("td",mt,n(c.p2Deaths),1),e("td",vt,[e("b",null,n(H(c.teamSeconds)),1)]),e("td",ht,[e("b",null,n(c.teamKills),1)]),e("td",_t,[e("b",null,n(c.teamDeaths),1)]),e("td",ft,n(c.rank??"‚Äî"),1),e("td",gt,[e("b",null,n(J(c.points)),1)])]))),128))])])]),e("div",bt,[t[32]||(t[32]=e("div",{class:"leg-item"},[e("span",{class:"dot"}),e("span",null,"Missing/DNF times score 0")],-1)),f.value==="table"?(p(),u("div",kt,[t[29]||(t[29]=e("span",{class:"dot"},null,-1)),e("span",null,"Points table: "+n(O.value.join(", ")),1)])):f.value==="percentile"?(p(),u("div",yt,[t[30]||(t[30]=e("span",{class:"dot"},null,-1)),e("span",null,"Percentile range: "+n(F.value)+"‚Äì"+n(R.value)+" (ties share score)",1)])):(p(),u("div",It,[t[31]||(t[31]=e("span",{class:"dot"},null,-1)),e("span",null,[K(" Gap vs best time. Window mode: "+n(i.value)+" ",1),i.value!=="auto"?(p(),u("span",St," (fixed="+n(b.value)+"s)",1)):D("",!0)])]))])])])])):D("",!0)],64))),128))])):(p(),u("tbody",Mt,[(p(!0),u(P,null,z(de.value,s=>(p(),u("tr",{key:s.teamId,class:"row"},[e("td",wt,n(s.rank??"‚Äî"),1),e("td",Tt,[e("div",xt,n(s.teamName),1)]),e("td",Dt,[N.value.get(s.teamId)?(p(),u("div",Pt,[e("div",Nt,[e("span",$t,n(N.value.get(s.teamId).player1.name),1),x(N.value.get(s.teamId).player1.twitch)?(p(),u("a",{key:0,class:"twitch",href:x(N.value.get(s.teamId).player1.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,Ct)):D("",!0)]),e("div",Kt,[e("span",Wt,n(N.value.get(s.teamId).player2.name),1),x(N.value.get(s.teamId).player2.twitch)?(p(),u("a",{key:0,class:"twitch",href:x(N.value.get(s.teamId).player2.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,Ft)):D("",!0)])])):(p(),u("div",Rt,t[34]||(t[34]=[e("div",{class:"player"},[e("span",{class:"pname"},"‚Äî")],-1),e("div",{class:"player"},[e("span",{class:"pname"},"‚Äî")],-1)])))]),e("td",Bt,[e("b",null,n(H(s.teamSeconds)),1)]),e("td",At,[e("span",Lt,n(J(s.points)),1)]),e("td",Ot,n(s.teamKills),1),e("td",Et,n(s.teamDeaths),1),t[35]||(t[35]=e("td",{class:"cell-actions"},null,-1))]))),128))]))])])]))}}),se=ne(Vt,[["__scopeId","data-v-53bf749a"]]),jt={class:"page"},Ht={class:"home"},Gt={class:"topbar"},zt={class:"top-actions"},Xt={class:"meta"},Yt={class:"pill"},Ut={class:"pill"},qt={key:0,class:"pill glow"},Jt={id:"leaderboard",class:"card"},Qt={class:"card-body"},Zt={key:0,class:"scroll-safe"},es={key:1,class:"skeleton"},ts={class:"sk-grid"},ss=ae({__name:"HomePageHidden",setup(Z){const v=C([]),k=C([]),T=C([]),A=C(null),f=C(new Date);let L=null;function O(b){const i=new Date(b);return Number.isNaN(i.getTime())?new Date(0):i}function W(b,i){return b===!0?!0:b===!1?!1:f.value.getTime()>=O(i).getTime()}function F(b){const i=O(b).getTime();return i===0?!1:f.value.getTime()>=i}const R=_(()=>{if(!A.value)return!1;for(const b of A.value.weeks||[])for(const i of b.seeds||[]){const M=W(i.releases.forceDownload,i.releases.downloadAt),B=!F(i.deadlineAt);if(M&&B)return!0}return!1}),E=_(()=>v.value?.length??0),V=_(()=>k.value?.length??0);return ue(async()=>{const[b,i]=await Promise.all([fetch("/data/teamsHidden.json",{cache:"no-store"}),fetch("/data/releases.json",{cache:"no-store"})]),M=await b.json();v.value=M.teams||[],k.value=M.races||[],T.value=M.pointsTable||[],A.value=await i.json(),L=window.setInterval(()=>f.value=new Date,1e3)}),pe(()=>{L&&window.clearInterval(L)}),(b,i)=>(p(),u("div",jt,[e("div",Ht,[e("header",Gt,[i[3]||(i[3]=me('<div class="title" data-v-ca0906e9><div class="spark" data-v-ca0906e9>üèÅ</div><div class="title-text" data-v-ca0906e9><div class="h1" data-v-ca0906e9>Leaderboard</div><div class="sub" data-v-ca0906e9> Ranked by team time with F1-style points. Expand rows for per-race details. </div></div></div>',1)),e("div",zt,[e("div",Xt,[e("span",Yt,[i[0]||(i[0]=e("span",{class:"dot"},null,-1)),K(" "+n(E.value)+" teams ",1)]),e("span",Ut,[i[1]||(i[1]=e("span",{class:"dot dot2"},null,-1)),K(" "+n(V.value)+" races ",1)]),R.value?(p(),u("span",qt,i[2]||(i[2]=[e("span",{class:"dot dot3"},null,-1),K(" Active seed live ",-1)]))):D("",!0)])])]),e("section",Jt,[i[7]||(i[7]=e("div",{class:"card-head"},[e("h2",null,"Overall Standings")],-1)),e("div",Qt,[v.value.length?(p(),u("div",Zt,[te(se,{teams:v.value,raceOrder:k.value,pointsTable:T.value},null,8,["teams","raceOrder","pointsTable"]),te(se,{teams:v.value,raceOrder:k.value,scoringMode:"percentile",percentileMin:5,percentileMax:25,percentileDecimals:0},null,8,["teams","raceOrder"])])):(p(),u("div",es,[i[4]||(i[4]=e("div",{class:"sk-line w40"},null,-1)),i[5]||(i[5]=e("div",{class:"sk-line w70"},null,-1)),i[6]||(i[6]=e("div",{class:"sk-line w55"},null,-1)),e("div",ts,[(p(),u(P,null,z(8,M=>e("div",{class:"sk-box",key:M})),64))])]))])])])]))}}),ns=ne(ss,[["__scopeId","data-v-ca0906e9"]]);export{ns as default};
