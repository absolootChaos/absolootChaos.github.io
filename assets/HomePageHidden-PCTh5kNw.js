import{d as ae,r as C,c as _,a as u,b as e,t as n,j as W,f as P,n as Q,F as N,e as z,o as p,_ as ne,g as pe,h as me,i as ve,l as Z}from"./index-Cb5kvp5K.js";const he={class:"lb-wrap"},_e={class:"lb-header"},fe={class:"lb-title"},ge={class:"lb-sub"},be={key:0},ye={key:1},ke={key:2},Ie={key:0},Me={class:"lb-controls"},Se=["onClick"],we={class:"table-wrap"},Te={class:"lb-table"},xe={class:"col-points"},De={class:"col-points"},Pe={key:0},Ne={class:"cell-rank"},$e={class:"cell-team"},Ce={class:"team-name"},We={class:"cell-players"},Ke={class:"players"},Fe={class:"player"},Re={class:"pname"},Be=["href"],Oe={class:"player"},Ae={class:"pname"},Le=["href"],Ee={class:"cell-points"},Ve={class:"points-pill"},je={class:"cell-stat"},He={class:"cell-stat"},Ge={class:"cell-time"},ze={class:"cell-actions"},Xe=["onClick"],Ye={key:0,class:"details"},Ue={colspan:"8"},qe={class:"details-card"},Je={class:"details-table-wrap"},Qe={class:"mini grouped"},Ze={class:"ghead"},et={class:"grp p1",colspan:"3"},tt={class:"grp-title"},st={class:"grp-name"},at={class:"grp p2",colspan:"3"},nt={class:"grp-title"},lt={class:"grp-name"},ot={class:"chead"},it={class:"col-pts"},ct={class:"race"},dt={class:"p1 time"},rt={class:"p1 stat"},ut={class:"p1 stat"},pt={class:"p2 time"},mt={class:"p2 stat"},vt={class:"p2 stat"},ht={class:"team time"},_t={class:"team stat"},ft={class:"team stat"},gt={class:"team rank"},bt={class:"team pts"},yt={class:"legend"},kt={key:0,class:"leg-item"},It={key:1,class:"leg-item"},Mt={key:2,class:"leg-item"},St={key:0},wt={key:1},Tt={class:"cell-rank"},xt={class:"cell-team"},Dt={class:"team-name"},Pt={class:"cell-players"},Nt={key:0,class:"players"},$t={class:"player"},Ct={class:"pname"},Wt=["href"],Kt={class:"player"},Ft={class:"pname"},Rt=["href"],Bt={key:1,class:"players"},Ot={class:"cell-time"},At={class:"cell-points"},Lt={class:"points-pill"},Et={class:"cell-stat"},Vt={class:"cell-stat"},jt=ae({__name:"LeaderboardRaceCard",props:{teams:{},raceOrder:{},includeMissingAsLast:{type:Boolean},scoringMode:{},pointsTable:{},decimals:{},percentileMin:{},percentileMax:{},gapMin:{},gapMax:{},gapWindowSeconds:{},gapWindowMode:{},closeWindowSeconds:{}},setup(te){const v=te,b=C({kind:"combined"}),T=C(null);function O(a){T.value=T.value===a?null:a}const f=_(()=>v.scoringMode??"table"),A=_(()=>v.includeMissingAsLast??!0),L=_(()=>v.pointsTable??[25,18,15,12,10,8,6,4,2,1]),K=_(()=>typeof v.decimals=="number"?Math.max(0,Math.floor(v.decimals)):0),F=_(()=>typeof v.percentileMin=="number"?v.percentileMin:25),R=_(()=>typeof v.percentileMax=="number"?v.percentileMax:100),E=_(()=>typeof v.gapMin=="number"?v.gapMin:1),V=_(()=>typeof v.gapMax=="number"?v.gapMax:25),y=_(()=>{const a=v.gapWindowSeconds;return typeof a=="number"&&isFinite(a)&&a>0?a:120}),d=_(()=>v.gapWindowMode??"max"),S=_(()=>{const a=v.closeWindowSeconds;return typeof a=="number"&&isFinite(a)&&a>=0?a:60}),B=_(()=>v.raceOrder?.length?v.raceOrder:(v.teams[0]?.races??[]).map((s,m)=>({raceId:s.raceId,label:s.label??`Race ${m+1}`}))),X=_(()=>b.value.kind==="race"?b.value.raceId:null),q=_(()=>f.value==="table"?"Points":f.value==="percentile"?"Percentile":"Gap Pts"),le=_(()=>{const a=f.value==="table"?"Points":f.value==="percentile"?"Percentile Points":"Gap Points";return X.value?`Team Leaderboard ‚Äî ${B.value.find(s=>s.raceId===X.value)?.label??"Race"}`:`Team Leaderboard ‚Äî Combined ${a}`}),x=_(()=>{const a=new Map;for(const t of v.teams)a.set(t.id,t);return a});function j(a,t,s){return Math.max(t,Math.min(s,a))}function Y(a,t){const s=Math.pow(10,t);return Math.round(a*s)/s}function J(a){if(!isFinite(a))return"0";const t=K.value;return t>0?a.toFixed(t):String(Math.round(a))}function D(a){if(!a)return null;const t=a.trim();return t?t.startsWith("http://")||t.startsWith("https://")?t:`https://twitch.tv/${t.replace(/^@/,"")}`:null}function H(a){if(a==null||!isFinite(a))return"‚Äî";const t=Math.max(0,Math.floor(a)),s=Math.floor(t/3600),m=Math.floor(t%3600/60),c=t%60;return s>0?`${s}:${String(m).padStart(2,"0")}:${String(c).padStart(2,"0")}`:`${m}:${String(c).padStart(2,"0")}`}function G(a){return typeof a=="number"&&isFinite(a)}function U(a){return typeof a=="number"&&isFinite(a)?Math.max(0,Math.floor(a)):0}function oe(a){if(a.status==="DNF"||a.status==="DNS")return null;if(G(a.teamSeconds))return a.teamSeconds;const t=a.player1Seconds,s=a.player2Seconds,m=G(t),c=G(s);return m&&c?t+s:m?t:c?s:null}function ie(a){const t=a?.bonusPoints;return typeof t=="number"&&isFinite(t)?t:0}function ce(a,t,s){const m=new Map,{minPts:c,maxPts:g,decimals:l,closeWindowSeconds:r}=s;for(let h=0;h<a.length;h++){const o=a[h],i=t.get(o.teamId)??c;if(h===0){m.set(o.teamId,Y(j(i,c,g),l));continue}const M=a[h-1],k=m.get(M.teamId)??g,w=o.teamSeconds-M.teamSeconds;let I;w<=r?I=k-1:I=Math.min(i,k-1),m.set(o.teamId,Y(j(I,c,g),l))}return m}function se(a){const t=v.teams.map(l=>{const r=l.races.find(I=>I.raceId===a),h=r?.player1Seconds,o=r?.player2Seconds,i=U(r?.player1Kills),M=U(r?.player2Kills),k=U(r?.player1Deaths),w=U(r?.player2Deaths);return{teamId:l.id,teamName:l.teamName,p1Seconds:G(h)?h:null,p2Seconds:G(o)?o:null,teamSeconds:r?oe(r):null,p1Kills:i,p2Kills:M,teamKills:i+M,p1Deaths:k,p2Deaths:w,teamDeaths:k+w,rank:null,points:0}}),s=t.filter(l=>l.teamSeconds!=null).map(l=>({...l,teamSeconds:l.teamSeconds}));s.sort((l,r)=>l.teamSeconds-r.teamSeconds);const m=new Map,c=new Map,g=s.length;if(g>0){if(s.forEach((l,r)=>m.set(l.teamId,r+1)),f.value==="table")s.forEach((l,r)=>c.set(l.teamId,L.value[r]??0));else if(f.value==="percentile"){const l=j(F.value,0,999999),r=j(R.value,0,999999),h=Math.min(l,r),o=Math.max(l,r);let i=0;for(;i<g;){const M=s[i].teamSeconds;let k=i;for(;k+1<g&&s[k+1].teamSeconds===M;)k++;const w=(i+k)/2;let I;if(g===1)I=o;else{const $=(g-1-w)/(g-1);I=h+$*(o-h)}I=Y(I,K.value);for(let $=i;$<=k;$++)c.set(s[$].teamId,I);i=k+1}}else{const l=E.value,r=V.value,h=s[0].teamSeconds,o=s[g-1].teamSeconds,i=Math.max(1,o-h),M=y.value,k=d.value==="fixed"?M:d.value==="auto"?i:Math.max(M,i);for(const w of s){const I=Math.max(0,w.teamSeconds-h),$=j(I/k,0,1),ue=Y(r-$*(r-l),K.value);c.set(w.teamId,ue)}}if(f.value==="percentile"||f.value==="gap"){const l=f.value==="percentile"?Math.min(F.value,R.value):E.value,r=f.value==="percentile"?Math.max(F.value,R.value):V.value,h=ce(s.map(o=>({teamId:o.teamId,teamSeconds:o.teamSeconds})),c,{minPts:l,maxPts:r,decimals:K.value,closeWindowSeconds:S.value});c.clear();for(const[o,i]of h.entries())c.set(o,i)}for(const l of t){const h=x.value.get(l.teamId)?.races.find(i=>i.raceId===a),o=ie(h);if(o!==0){const i=c.get(l.teamId)??0;c.set(l.teamId,i+o)}}}if(A.value){const l=t.filter(h=>h.teamSeconds==null),r=s.length;l.forEach((h,o)=>m.set(h.teamId,r+o+1))}return t.map(l=>({...l,rank:m.get(l.teamId)??null,points:c.get(l.teamId)??0})).sort((l,r)=>{const h=l.rank??Number.POSITIVE_INFINITY,o=r.rank??Number.POSITIVE_INFINITY;return h!==o?h-o:l.teamName.localeCompare(r.teamName)})}const de=_(()=>{const a=new Map;for(const s of B.value)a.set(s.raceId,se(s.raceId));return v.teams.map(s=>{const m=B.value.map(o=>{const i=(a.get(o.raceId)??[]).find(M=>M.teamId===s.id);return{raceId:o.raceId,label:o.label,p1Seconds:i?.p1Seconds??null,p2Seconds:i?.p2Seconds??null,teamSeconds:i?.teamSeconds??null,p1Kills:i?.p1Kills??0,p2Kills:i?.p2Kills??0,teamKills:i?.teamKills??0,p1Deaths:i?.p1Deaths??0,p2Deaths:i?.p2Deaths??0,teamDeaths:i?.teamDeaths??0,rank:i?.rank??null,points:i?.points??0}}),c=m.reduce((o,i)=>o+i.points,0),g=m.reduce((o,i)=>o+i.teamKills,0),l=m.reduce((o,i)=>o+i.teamDeaths,0),r=m.map(o=>o.teamSeconds).filter(o=>o!=null&&isFinite(o)),h=r.length?r.reduce((o,i)=>o+i,0):null;return{teamId:s.id,teamName:s.teamName,player1:s.player1,player2:s.player2,totalPoints:c,totalTeamSeconds:h,totalTeamKills:g,totalTeamDeaths:l,raceBreakdown:m}}).sort((s,m)=>{if(m.totalPoints!==s.totalPoints)return m.totalPoints-s.totalPoints;const c=s.raceBreakdown.reduce((l,r)=>l+(r.rank??9999),0)/Math.max(1,s.raceBreakdown.length),g=m.raceBreakdown.reduce((l,r)=>l+(r.rank??9999),0)/Math.max(1,m.raceBreakdown.length);return c!==g?c-g:s.teamName.localeCompare(m.teamName)})}),re=_(()=>X.value?se(X.value):[]);return(a,t)=>(p(),u("div",he,[e("header",_e,[e("div",fe,[e("h2",null,n(le.value),1),e("p",ge,[t[2]||(t[2]=W(" Per race: team time = P1 + P2. ",-1)),f.value==="table"?(p(),u("span",be,"F1 points table by finish.")):f.value==="percentile"?(p(),u("span",ye," Position percentile ")):(p(),u("span",ke,[W(" Gap scoring vs best time: "+n(E.value)+"‚Äì"+n(V.value)+". Window mode: ",1),e("b",null,n(d.value),1),d.value!=="auto"?(p(),u("span",Ie," (fixed="+n(y.value)+"s)",1)):P("",!0),t[1]||(t[1]=W(". ",-1))]))])]),e("div",Me,[e("button",{class:Q(["chip",{active:b.value.kind==="combined"}]),onClick:t[0]||(t[0]=s=>b.value={kind:"combined"})}," Combined ",2),(p(!0),u(N,null,z(B.value,s=>(p(),u("button",{key:s.raceId,class:Q(["chip",{active:b.value.kind==="race"&&b.value.raceId===s.raceId}]),onClick:m=>b.value={kind:"race",raceId:s.raceId}},n(s.label),11,Se))),128))])]),e("div",we,[e("table",Te,[e("thead",null,[e("tr",null,[t[9]||(t[9]=e("th",{class:"col-rank"},"#",-1)),t[10]||(t[10]=e("th",{class:"col-team"},"Team",-1)),t[11]||(t[11]=e("th",{class:"col-players"},"Players",-1)),b.value.kind==="combined"?(p(),u(N,{key:0},[e("th",xe,n(q.value),1),t[3]||(t[3]=e("th",{class:"col-stat"},"Team Checks",-1)),t[4]||(t[4]=e("th",{class:"col-stat"},"Team Deaths",-1)),t[5]||(t[5]=e("th",{class:"col-time"},"Total Time",-1))],64)):(p(),u(N,{key:1},[t[6]||(t[6]=e("th",{class:"col-time"},"Team Time",-1)),e("th",De,n(q.value),1),t[7]||(t[7]=e("th",{class:"col-stat"},"Team Checks",-1)),t[8]||(t[8]=e("th",{class:"col-stat"},"Team Deaths",-1))],64)),t[12]||(t[12]=e("th",{class:"col-actions"},null,-1))])]),b.value.kind==="combined"?(p(),u("tbody",Pe,[(p(!0),u(N,null,z(de.value,(s,m)=>(p(),u(N,{key:s.teamId},[e("tr",{class:Q(["row",{expanded:T.value===s.teamId}])},[e("td",Ne,n(m+1),1),e("td",$e,[e("div",Ce,n(s.teamName),1)]),e("td",We,[e("div",Ke,[e("div",Fe,[e("span",Re,n(s.player1.name),1),D(s.player1.twitch)?(p(),u("a",{key:0,class:"twitch",href:D(s.player1.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,Be)):P("",!0)]),e("div",Oe,[e("span",Ae,n(s.player2.name),1),D(s.player2.twitch)?(p(),u("a",{key:0,class:"twitch",href:D(s.player2.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,Le)):P("",!0)])])]),e("td",Ee,[e("span",Ve,n(J(s.totalPoints)),1)]),e("td",je,n(s.totalTeamKills),1),e("td",He,n(s.totalTeamDeaths),1),e("td",Ge,n(H(s.totalTeamSeconds)),1),e("td",ze,[e("button",{class:"btn",onClick:c=>O(s.teamId)},n(T.value===s.teamId?"Hide":"Details"),9,Xe)])],2),T.value===s.teamId?(p(),u("tr",Ye,[e("td",Ue,[e("div",qe,[t[33]||(t[33]=e("div",{class:"details-head"},[e("div",{class:"dh-title"},"Race breakdown"),e("div",{class:"dh-sub"},"Shows per-player and team totals each race.")],-1)),e("div",Je,[e("table",Qe,[e("thead",null,[e("tr",Ze,[t[17]||(t[17]=e("th",{class:"col-race",rowspan:"2"},"Race",-1)),e("th",et,[e("div",tt,[t[13]||(t[13]=e("span",{class:"grp-dot p1"},null,-1)),e("span",st,n(s.player1.name),1),t[14]||(t[14]=e("span",{class:"grp-tag"},"P1",-1))])]),e("th",at,[e("div",nt,[t[15]||(t[15]=e("span",{class:"grp-dot p2"},null,-1)),e("span",lt,n(s.player2.name),1),t[16]||(t[16]=e("span",{class:"grp-tag"},"P2",-1))])]),t[18]||(t[18]=e("th",{class:"grp team",colspan:"5"},[e("div",{class:"grp-title"},[e("span",{class:"grp-dot team"}),e("span",{class:"grp-name"},"Team")])],-1))]),e("tr",ot,[t[19]||(t[19]=e("th",{class:"col-time"},"Time",-1)),t[20]||(t[20]=e("th",{class:"col-stat"},"Checks",-1)),t[21]||(t[21]=e("th",{class:"col-stat"},"Deaths",-1)),t[22]||(t[22]=e("th",{class:"col-time"},"Time",-1)),t[23]||(t[23]=e("th",{class:"col-stat"},"Checks",-1)),t[24]||(t[24]=e("th",{class:"col-stat"},"Deaths",-1)),t[25]||(t[25]=e("th",{class:"col-time"},"Time",-1)),t[26]||(t[26]=e("th",{class:"col-stat"},"Checks",-1)),t[27]||(t[27]=e("th",{class:"col-stat"},"Deaths",-1)),t[28]||(t[28]=e("th",{class:"col-rank"},"Rank",-1)),e("th",it,n(q.value),1)])]),e("tbody",null,[(p(!0),u(N,null,z(s.raceBreakdown,c=>(p(),u("tr",{key:c.raceId,class:"rrow"},[e("td",ct,n(c.label),1),e("td",dt,n(H(c.p1Seconds)),1),e("td",rt,n(c.p1Kills),1),e("td",ut,n(c.p1Deaths),1),e("td",pt,n(H(c.p2Seconds)),1),e("td",mt,n(c.p2Kills),1),e("td",vt,n(c.p2Deaths),1),e("td",ht,[e("b",null,n(H(c.teamSeconds)),1)]),e("td",_t,[e("b",null,n(c.teamKills),1)]),e("td",ft,[e("b",null,n(c.teamDeaths),1)]),e("td",gt,n(c.rank??"‚Äî"),1),e("td",bt,[e("b",null,n(J(c.points)),1)])]))),128))])])]),e("div",yt,[t[32]||(t[32]=e("div",{class:"leg-item"},[e("span",{class:"dot"}),e("span",null,"Missing/DNF times score 0")],-1)),f.value==="table"?(p(),u("div",kt,[t[29]||(t[29]=e("span",{class:"dot"},null,-1)),e("span",null,"Points table: "+n(L.value.join(", ")),1)])):f.value==="percentile"?(p(),u("div",It,[t[30]||(t[30]=e("span",{class:"dot"},null,-1)),e("span",null,"Percentile range: "+n(F.value)+"‚Äì"+n(R.value)+" (ties share score)",1)])):(p(),u("div",Mt,[t[31]||(t[31]=e("span",{class:"dot"},null,-1)),e("span",null,[W(" Gap vs best time. Window mode: "+n(d.value)+" ",1),d.value!=="auto"?(p(),u("span",St," (fixed="+n(y.value)+"s)",1)):P("",!0)])]))])])])])):P("",!0)],64))),128))])):(p(),u("tbody",wt,[(p(!0),u(N,null,z(re.value,s=>(p(),u("tr",{key:s.teamId,class:"row"},[e("td",Tt,n(s.rank??"‚Äî"),1),e("td",xt,[e("div",Dt,n(s.teamName),1)]),e("td",Pt,[x.value.get(s.teamId)?(p(),u("div",Nt,[e("div",$t,[e("span",Ct,n(x.value.get(s.teamId).player1.name),1),D(x.value.get(s.teamId).player1.twitch)?(p(),u("a",{key:0,class:"twitch",href:D(x.value.get(s.teamId).player1.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,Wt)):P("",!0)]),e("div",Kt,[e("span",Ft,n(x.value.get(s.teamId).player2.name),1),D(x.value.get(s.teamId).player2.twitch)?(p(),u("a",{key:0,class:"twitch",href:D(x.value.get(s.teamId).player2.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,Rt)):P("",!0)])])):(p(),u("div",Bt,t[34]||(t[34]=[e("div",{class:"player"},[e("span",{class:"pname"},"‚Äî")],-1),e("div",{class:"player"},[e("span",{class:"pname"},"‚Äî")],-1)])))]),e("td",Ot,[e("b",null,n(H(s.teamSeconds)),1)]),e("td",At,[e("span",Lt,n(J(s.points)),1)]),e("td",Et,n(s.teamKills),1),e("td",Vt,n(s.teamDeaths),1),t[35]||(t[35]=e("td",{class:"cell-actions"},null,-1))]))),128))]))])])]))}}),ee=ne(jt,[["__scopeId","data-v-d451b1a0"]]),Ht={class:"page"},Gt={class:"home"},zt={class:"topbar"},Xt={class:"top-actions"},Yt={class:"meta"},Ut={class:"pill"},qt={class:"pill"},Jt={key:0,class:"pill glow"},Qt={id:"leaderboard",class:"card"},Zt={class:"card-body"},es={key:0,class:"scroll-safe"},ts={key:1,class:"skeleton"},ss={class:"sk-grid"},as=ae({__name:"HomePageHidden",setup(te){const v=C([]),b=C([]),T=C([]),O=C(null),f=C(new Date);let A=null;function L(y){const d=new Date(y);return Number.isNaN(d.getTime())?new Date(0):d}function K(y,d){return y===!0?!0:y===!1?!1:f.value.getTime()>=L(d).getTime()}function F(y){const d=L(y).getTime();return d===0?!1:f.value.getTime()>=d}const R=_(()=>{if(!O.value)return!1;for(const y of O.value.weeks||[])for(const d of y.seeds||[]){const S=K(d.releases.forceDownload,d.releases.downloadAt),B=!F(d.deadlineAt);if(S&&B)return!0}return!1}),E=_(()=>v.value?.length??0),V=_(()=>b.value?.length??0);return pe(async()=>{const[y,d]=await Promise.all([fetch("/data/teamsHidden.json",{cache:"no-store"}),fetch("/data/releases.json",{cache:"no-store"})]),S=await y.json();v.value=S.teams||[],b.value=S.races||[],T.value=S.pointsTable||[],O.value=await d.json(),A=window.setInterval(()=>f.value=new Date,1e3)}),me(()=>{A&&window.clearInterval(A)}),(y,d)=>(p(),u("div",Ht,[e("div",Gt,[e("header",zt,[d[3]||(d[3]=ve('<div class="title" data-v-94c6be29><div class="spark" data-v-94c6be29>üèÅ</div><div class="title-text" data-v-94c6be29><div class="h1" data-v-94c6be29>Leaderboard</div><div class="sub" data-v-94c6be29> Ranked by team time with F1-style points. Expand rows for per-race details. </div></div></div>',1)),e("div",Xt,[e("div",Yt,[e("span",Ut,[d[0]||(d[0]=e("span",{class:"dot"},null,-1)),W(" "+n(E.value)+" teams ",1)]),e("span",qt,[d[1]||(d[1]=e("span",{class:"dot dot2"},null,-1)),W(" "+n(V.value)+" races ",1)]),R.value?(p(),u("span",Jt,d[2]||(d[2]=[e("span",{class:"dot dot3"},null,-1),W(" Active seed live ",-1)]))):P("",!0)])])]),e("section",Qt,[d[7]||(d[7]=e("div",{class:"card-head"},[e("h2",null,"Overall Standings")],-1)),e("div",Zt,[v.value.length?(p(),u("div",es,[Z(ee,{teams:v.value,raceOrder:b.value,pointsTable:T.value},null,8,["teams","raceOrder","pointsTable"]),Z(ee,{teams:v.value,raceOrder:b.value,scoringMode:"percentile",percentileMin:10,percentileMax:50,percentileDecimals:0},null,8,["teams","raceOrder"]),Z(ee,{teams:v.value,raceOrder:b.value,scoringMode:"gap",gapMin:10,gapMax:50,gapWindowMode:"max",gapWindowSeconds:180,closeWindowSeconds:60,decimals:0},null,8,["teams","raceOrder"])])):(p(),u("div",ts,[d[4]||(d[4]=e("div",{class:"sk-line w40"},null,-1)),d[5]||(d[5]=e("div",{class:"sk-line w70"},null,-1)),d[6]||(d[6]=e("div",{class:"sk-line w55"},null,-1)),e("div",ss,[(p(),u(N,null,z(8,S=>e("div",{class:"sk-box",key:S})),64))])]))])])])]))}}),ls=ne(as,[["__scopeId","data-v-94c6be29"]]);export{ls as default};
