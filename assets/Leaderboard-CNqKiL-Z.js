import{d as Y,r as L,c as k,b as u,f as t,t as a,n as F,F as f,g as $,i as D,j as m,_ as q}from"./index-B6898A7F.js";const G={class:"lb-wrap"},H={class:"lb-header"},J={class:"lb-title"},Q={class:"lb-controls"},U=["onClick"],X={class:"table-wrap"},Z={class:"lb-table"},tt={key:0},et={class:"cell-rank"},st={class:"cell-team"},at={class:"team-name"},lt={class:"cell-players"},nt={class:"players"},ot={class:"player"},it={class:"pname"},dt=["href"],ct={class:"player"},rt={class:"pname"},ut=["href"],mt={class:"cell-points"},pt={class:"points-pill"},ht={class:"cell-stat"},vt={class:"cell-stat"},yt={class:"cell-time"},_t={class:"cell-actions"},kt=["onClick"],bt={key:0,class:"details"},ft={colspan:"8"},It={class:"details-card"},St={class:"details-table-wrap"},gt={class:"mini"},Tt={class:"legend"},Dt={class:"leg-item"},Pt={key:1},Kt={class:"cell-rank"},Nt={class:"cell-team"},Mt={class:"team-name"},Ct={class:"cell-players"},Bt={key:0,class:"players"},$t={class:"player"},Ft={class:"pname"},Rt=["href"],xt={class:"player"},Lt={class:"pname"},wt=["href"],Et={key:1,class:"players"},At={class:"cell-time"},Vt={class:"cell-points"},Ot={class:"points-pill"},jt={class:"cell-stat"},zt={class:"cell-stat"},Wt=Y({__name:"Leaderboard",props:{teams:{},raceOrder:{},pointsTable:{},includeMissingAsLast:{type:Boolean}},setup(w){const y=w,h=L({kind:"combined"}),I=L(null);function E(l){I.value=I.value===l?null:l}const R=k(()=>y.pointsTable??[25,18,15,12,10,8,6,4,2,1]),A=k(()=>y.includeMissingAsLast??!0),P=k(()=>y.raceOrder?.length?y.raceOrder:(y.teams[0]?.races??[]).map((s,n)=>({raceId:s.raceId,label:s.label??`Race ${n+1}`}))),K=k(()=>h.value.kind==="race"?h.value.raceId:null),V=k(()=>K.value?`Team Leaderboard — ${P.value.find(e=>e.raceId===K.value)?.label??"Race"}`:"Team Leaderboard — Combined Points"),b=k(()=>{const l=new Map;for(const e of y.teams)l.set(e.id,e);return l});function _(l){if(!l)return null;const e=l.trim();return e?e.startsWith("http://")||e.startsWith("https://")?e:`https://twitch.tv/${e.replace(/^@/,"")}`:null}function S(l){if(l==null||!isFinite(l))return"—";const e=Math.max(0,Math.floor(l)),s=Math.floor(e/3600),n=Math.floor(e%3600/60),o=e%60;return s>0?`${s}:${String(n).padStart(2,"0")}:${String(o).padStart(2,"0")}`:`${n}:${String(o).padStart(2,"0")}`}function g(l){return typeof l=="number"&&isFinite(l)}function N(l){return typeof l=="number"&&isFinite(l)?Math.max(0,Math.floor(l)):0}function O(l){if(l.status==="DNF"||l.status==="DNS")return null;if(g(l.teamSeconds))return l.teamSeconds;const e=l.player1Seconds,s=l.player2Seconds,n=g(e),o=g(s);return n&&o?e+s:n?e:o?s:null}function x(l){const e=y.teams.map(i=>{const r=i.races.find(c=>c.raceId===l),p=r?.player1Seconds,v=r?.player2Seconds,M=N(r?.player1Kills),C=N(r?.player2Kills),T=N(r?.player1Deaths),B=N(r?.player2Deaths);return{teamId:i.id,teamName:i.teamName,p1Seconds:g(p)?p:null,p2Seconds:g(v)?v:null,teamSeconds:r?O(r):null,p1Kills:M,p2Kills:C,teamKills:M+C,p1Deaths:T,p2Deaths:B,teamDeaths:T+B,rank:null,points:0}}),s=e.filter(i=>i.teamSeconds!=null).map(i=>({...i,teamSeconds:i.teamSeconds}));s.sort((i,r)=>i.teamSeconds-r.teamSeconds);const n=new Map,o=new Map;if(s.forEach((i,r)=>{n.set(i.teamId,r+1),o.set(i.teamId,R.value[r]??0)}),A.value){const i=e.filter(p=>p.teamSeconds==null),r=s.length;i.forEach((p,v)=>n.set(p.teamId,r+v+1))}return e.map(i=>({...i,rank:n.get(i.teamId)??null,points:o.get(i.teamId)??0})).sort((i,r)=>{const p=i.rank??Number.POSITIVE_INFINITY,v=r.rank??Number.POSITIVE_INFINITY;return p!==v?p-v:i.teamName.localeCompare(r.teamName)})}const j=k(()=>{const l=new Map;for(const s of P.value)l.set(s.raceId,x(s.raceId));return y.teams.map(s=>{const n=P.value.map(c=>{const d=(l.get(c.raceId)??[]).find(W=>W.teamId===s.id);return{raceId:c.raceId,label:c.label,p1Seconds:d?.p1Seconds??null,p2Seconds:d?.p2Seconds??null,teamSeconds:d?.teamSeconds??null,p1Kills:d?.p1Kills??0,p2Kills:d?.p2Kills??0,teamKills:d?.teamKills??0,p1Deaths:d?.p1Deaths??0,p2Deaths:d?.p2Deaths??0,teamDeaths:d?.teamDeaths??0,rank:d?.rank??null,points:d?.points??0}}),o=n.reduce((c,d)=>c+d.points,0),i=n.reduce((c,d)=>c+d.teamKills,0),r=n.reduce((c,d)=>c+d.teamDeaths,0),p=n.reduce((c,d)=>c+d.p1Kills,0),v=n.reduce((c,d)=>c+d.p2Kills,0),M=n.reduce((c,d)=>c+d.p1Deaths,0),C=n.reduce((c,d)=>c+d.p2Deaths,0),T=n.map(c=>c.teamSeconds).filter(c=>c!=null&&isFinite(c)),B=T.length?T.reduce((c,d)=>c+d,0):null;return{teamId:s.id,teamName:s.teamName,player1:s.player1,player2:s.player2,totalPoints:o,totalTeamSeconds:B,totalTeamKills:i,totalTeamDeaths:r,totalP1Kills:p,totalP2Kills:v,totalP1Deaths:M,totalP2Deaths:C,raceBreakdown:n}}).sort((s,n)=>{if(n.totalPoints!==s.totalPoints)return n.totalPoints-s.totalPoints;const o=s.raceBreakdown.reduce((r,p)=>r+(p.rank??9999),0)/Math.max(1,s.raceBreakdown.length),i=n.raceBreakdown.reduce((r,p)=>r+(p.rank??9999),0)/Math.max(1,n.raceBreakdown.length);return o!==i?o-i:s.teamName.localeCompare(n.teamName)})}),z=k(()=>K.value?x(K.value):[]);return(l,e)=>(m(),u("div",G,[t("header",H,[t("div",J,[t("h2",null,a(V.value),1),e[1]||(e[1]=t("p",{class:"lb-sub"}," Per race: team time = P1 + P2. Points awarded by finish. Combined shows totals for points, kills, and deaths. ",-1))]),t("div",Q,[t("button",{class:F(["chip",{active:h.value.kind==="combined"}]),onClick:e[0]||(e[0]=s=>h.value={kind:"combined"})}," Combined ",2),(m(!0),u(f,null,$(P.value,s=>(m(),u("button",{key:s.raceId,class:F(["chip",{active:h.value.kind==="race"&&h.value.raceId===s.raceId}]),onClick:n=>h.value={kind:"race",raceId:s.raceId}},a(s.label),11,U))),128))])]),t("div",X,[t("table",Z,[t("thead",null,[t("tr",null,[e[10]||(e[10]=t("th",{class:"col-rank"},"#",-1)),e[11]||(e[11]=t("th",{class:"col-team"},"Team",-1)),e[12]||(e[12]=t("th",{class:"col-players"},"Players",-1)),h.value.kind==="combined"?(m(),u(f,{key:0},[e[2]||(e[2]=t("th",{class:"col-points"},"Points",-1)),e[3]||(e[3]=t("th",{class:"col-stat"},"Team Checks",-1)),e[4]||(e[4]=t("th",{class:"col-stat"},"Team Deaths",-1)),e[5]||(e[5]=t("th",{class:"col-time"},"Total Time",-1))],64)):(m(),u(f,{key:1},[e[6]||(e[6]=t("th",{class:"col-time"},"Team Time",-1)),e[7]||(e[7]=t("th",{class:"col-points"},"Points",-1)),e[8]||(e[8]=t("th",{class:"col-stat"},"Team Checks",-1)),e[9]||(e[9]=t("th",{class:"col-stat"},"Team Deaths",-1))],64)),e[13]||(e[13]=t("th",{class:"col-actions"},null,-1))])]),h.value.kind==="combined"?(m(),u("tbody",tt,[(m(!0),u(f,null,$(j.value,(s,n)=>(m(),u(f,{key:s.teamId},[t("tr",{class:F(["row",{expanded:I.value===s.teamId}])},[t("td",et,a(n+1),1),t("td",st,[t("div",at,a(s.teamName),1)]),t("td",lt,[t("div",nt,[t("div",ot,[t("span",it,a(s.player1.name),1),_(s.player1.twitch)?(m(),u("a",{key:0,class:"twitch",href:_(s.player1.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,dt)):D("",!0)]),t("div",ct,[t("span",rt,a(s.player2.name),1),_(s.player2.twitch)?(m(),u("a",{key:0,class:"twitch",href:_(s.player2.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,ut)):D("",!0)])])]),t("td",mt,[t("span",pt,a(s.totalPoints),1)]),t("td",ht,a(s.totalTeamKills),1),t("td",vt,a(s.totalTeamDeaths),1),t("td",yt,a(S(s.totalTeamSeconds)),1),t("td",_t,[t("button",{class:"btn",onClick:o=>E(s.teamId)},a(I.value===s.teamId?"Hide":"Details"),9,kt)])],2),I.value===s.teamId?(m(),u("tr",bt,[t("td",ft,[t("div",It,[e[22]||(e[22]=t("div",{class:"details-head"},[t("div",{class:"dh-title"},"Race breakdown"),t("div",{class:"dh-sub"},"Shows per-player and team totals each race.")],-1)),t("div",St,[t("table",gt,[t("thead",null,[t("tr",null,[e[14]||(e[14]=t("th",null,"Race",-1)),t("th",null,a(s.player1.name)+" Time",1),t("th",null,a(s.player1.name)+" Checks",1),t("th",null,a(s.player1.name)+" Deaths",1),t("th",null,a(s.player2.name)+" Time",1),t("th",null,a(s.player2.name)+" Checks",1),t("th",null,a(s.player2.name)+" Deaths",1),e[15]||(e[15]=t("th",null,"Team Time",-1)),e[16]||(e[16]=t("th",null,"Team Checks",-1)),e[17]||(e[17]=t("th",null,"Team Deaths",-1)),e[18]||(e[18]=t("th",null,"Rank",-1)),e[19]||(e[19]=t("th",null,"Pts",-1))])]),t("tbody",null,[(m(!0),u(f,null,$(s.raceBreakdown,o=>(m(),u("tr",{key:o.raceId},[t("td",null,a(o.label),1),t("td",null,a(S(o.p1Seconds)),1),t("td",null,a(o.p1Kills),1),t("td",null,a(o.p1Deaths),1),t("td",null,a(S(o.p2Seconds)),1),t("td",null,a(o.p2Kills),1),t("td",null,a(o.p2Deaths),1),t("td",null,[t("b",null,a(S(o.teamSeconds)),1)]),t("td",null,[t("b",null,a(o.teamKills),1)]),t("td",null,[t("b",null,a(o.teamDeaths),1)]),t("td",null,a(o.rank??"—"),1),t("td",null,[t("b",null,a(o.points),1)])]))),128))])])]),t("div",Tt,[e[21]||(e[21]=t("div",{class:"leg-item"},[t("span",{class:"dot"}),t("span",null,"Missing/DNF times score 0 points")],-1)),t("div",Dt,[e[20]||(e[20]=t("span",{class:"dot"},null,-1)),t("span",null,"Points table: "+a(R.value.join(", ")),1)])])])])])):D("",!0)],64))),128))])):(m(),u("tbody",Pt,[(m(!0),u(f,null,$(z.value,s=>(m(),u("tr",{key:s.teamId,class:"row"},[t("td",Kt,a(s.rank??"—"),1),t("td",Nt,[t("div",Mt,a(s.teamName),1)]),t("td",Ct,[b.value.get(s.teamId)?(m(),u("div",Bt,[t("div",$t,[t("span",Ft,a(b.value.get(s.teamId).player1.name),1),_(b.value.get(s.teamId).player1.twitch)?(m(),u("a",{key:0,class:"twitch",href:_(b.value.get(s.teamId).player1.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,Rt)):D("",!0)]),t("div",xt,[t("span",Lt,a(b.value.get(s.teamId).player2.name),1),_(b.value.get(s.teamId).player2.twitch)?(m(),u("a",{key:0,class:"twitch",href:_(b.value.get(s.teamId).player2.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,wt)):D("",!0)])])):(m(),u("div",Et,e[23]||(e[23]=[t("div",{class:"player"},[t("span",{class:"pname"},"—")],-1),t("div",{class:"player"},[t("span",{class:"pname"},"—")],-1)])))]),t("td",At,[t("b",null,a(S(s.teamSeconds)),1)]),t("td",Vt,[t("span",Ot,a(s.points),1)]),t("td",jt,a(s.teamKills),1),t("td",zt,a(s.teamDeaths),1),e[24]||(e[24]=t("td",{class:"cell-actions"},null,-1))]))),128))]))])])]))}}),qt=q(Wt,[["__scopeId","data-v-83b22ba8"]]);export{qt as T};
