import{d as ct,r as J,c as v,b as p,f as t,t as n,h as E,i as x,n as Y,F as w,g as V,j as m,_ as dt}from"./index-CK0qYAic.js";const rt={class:"lb-wrap"},pt={class:"lb-header"},mt={class:"lb-title"},ut={class:"lb-sub"},ht={key:0},vt={key:1},_t={key:2},ft={key:0},gt={class:"lb-controls"},bt=["onClick"],yt={class:"table-wrap"},kt={class:"lb-table"},It={class:"col-points"},St={class:"col-points"},Mt={key:0},Tt={class:"cell-rank"},xt={class:"cell-team"},wt={class:"team-name"},Pt={class:"cell-players"},Dt={class:"players"},Nt={class:"player"},Ct={class:"pname"},Kt=["href"],Wt={class:"player"},Ft={class:"pname"},Bt=["href"],$t={class:"cell-points"},Rt={class:"points-pill"},Lt={class:"cell-stat"},At={class:"cell-stat"},Et={class:"cell-time"},Vt={class:"cell-actions"},Gt=["onClick"],Ot={key:0,class:"details"},jt={colspan:"8"},zt={class:"details-card"},Xt={class:"details-table-wrap"},Yt={class:"mini grouped"},qt={class:"ghead"},Ht={class:"grp p1",colspan:"3"},Jt={class:"grp-title"},Qt={class:"grp-name"},Ut={class:"grp p2",colspan:"3"},Zt={class:"grp-title"},te={class:"grp-name"},ee={class:"chead"},se={class:"col-pts"},ae={class:"race"},ne={class:"p1 time"},le={class:"p1 stat"},oe={class:"p1 stat"},ie={class:"p2 time"},ce={class:"p2 stat"},de={class:"p2 stat"},re={class:"team time"},pe={class:"team stat"},me={class:"team stat"},ue={class:"team rank"},he={class:"team pts"},ve={class:"legend"},_e={key:0,class:"leg-item"},fe={key:1,class:"leg-item"},ge={key:2,class:"leg-item"},be={key:0},ye={key:1},ke={class:"cell-rank"},Ie={class:"cell-team"},Se={class:"team-name"},Me={class:"cell-players"},Te={key:0,class:"players"},xe={class:"player"},we={class:"pname"},Pe=["href"],De={class:"player"},Ne={class:"pname"},Ce=["href"],Ke={key:1,class:"players"},We={class:"cell-time"},Fe={class:"cell-points"},Be={class:"points-pill"},$e={class:"cell-stat"},Re={class:"cell-stat"},Le=ct({__name:"LeaderboardRaceCard",props:{teams:{},raceOrder:{},includeMissingAsLast:{type:Boolean},scoringMode:{},pointsTable:{},decimals:{},percentileMin:{},percentileMax:{},gapMin:{},gapMax:{},gapWindowSeconds:{},gapWindowMode:{},closeWindowSeconds:{}},setup(Q){const h=Q,k=J({kind:"combined"}),D=J(null);function U(a){D.value=D.value===a?null:a}const f=v(()=>h.scoringMode??"table"),Z=v(()=>h.includeMissingAsLast??!0),q=v(()=>h.pointsTable??[25,18,15,12,10,8,6,4,2,1]),W=v(()=>typeof h.decimals=="number"?Math.max(0,Math.floor(h.decimals)):0),F=v(()=>typeof h.percentileMin=="number"?h.percentileMin:25),B=v(()=>typeof h.percentileMax=="number"?h.percentileMax:100),G=v(()=>typeof h.gapMin=="number"?h.gapMin:1),O=v(()=>typeof h.gapMax=="number"?h.gapMax:25),j=v(()=>{const a=h.gapWindowSeconds;return typeof a=="number"&&isFinite(a)&&a>0?a:120}),P=v(()=>h.gapWindowMode??"max"),tt=v(()=>{const a=h.closeWindowSeconds;return typeof a=="number"&&isFinite(a)&&a>=0?a:60}),$=v(()=>h.raceOrder?.length?h.raceOrder:(h.teams[0]?.races??[]).map((s,r)=>({raceId:s.raceId,label:s.label??`Race ${r+1}`}))),R=v(()=>k.value.kind==="race"?k.value.raceId:null),z=v(()=>f.value==="table"?"Points":f.value==="percentile"?"Percentile":"Gap Pts"),et=v(()=>{const a=f.value==="table"?"Points":f.value==="percentile"?"Percentile Points":"Gap Points";return R.value?`Team Leaderboard — ${$.value.find(s=>s.raceId===R.value)?.label??"Race"}`:`Team Leaderboard — Combined ${a}`}),S=v(()=>{const a=new Map;for(const e of h.teams)a.set(e.id,e);return a});function N(a,e,s){return Math.max(e,Math.min(s,a))}function L(a,e){const s=Math.pow(10,e);return Math.round(a*s)/s}function X(a){if(!isFinite(a))return"0";const e=W.value;return e>0?a.toFixed(e):String(Math.round(a))}function M(a){if(!a)return null;const e=a.trim();return e?e.startsWith("http://")||e.startsWith("https://")?e:`https://twitch.tv/${e.replace(/^@/,"")}`:null}function C(a){if(a==null||!isFinite(a))return"—";const e=Math.max(0,Math.floor(a)),s=Math.floor(e/3600),r=Math.floor(e%3600/60),c=e%60;return s>0?`${s}:${String(r).padStart(2,"0")}:${String(c).padStart(2,"0")}`:`${r}:${String(c).padStart(2,"0")}`}function K(a){return typeof a=="number"&&isFinite(a)}function A(a){return typeof a=="number"&&isFinite(a)?Math.max(0,Math.floor(a)):0}function st(a){if(a.status==="DNF"||a.status==="DNS")return null;if(K(a.teamSeconds))return a.teamSeconds;const e=a.player1Seconds,s=a.player2Seconds,r=K(e),c=K(s);return r&&c?e+s:r?e:c?s:null}function at(a){const e=a?.bonusPoints;return typeof e=="number"&&isFinite(e)?e:0}function nt(a,e,s){const r=new Map,{minPts:c,maxPts:_,decimals:l,closeWindowSeconds:d}=s;for(let u=0;u<a.length;u++){const o=a[u],i=e.get(o.teamId)??c;if(u===0){r.set(o.teamId,L(N(i,c,_),l));continue}const y=a[u-1],g=r.get(y.teamId)??_,I=o.teamSeconds-y.teamSeconds;let b;I<=d?b=g-1:b=Math.min(i,g-1),r.set(o.teamId,L(N(b,c,_),l))}return r}function H(a){const e=h.teams.map(l=>{const d=l.races.find(b=>b.raceId===a),u=d?.player1Seconds,o=d?.player2Seconds,i=A(d?.player1Kills),y=A(d?.player2Kills),g=A(d?.player1Deaths),I=A(d?.player2Deaths);return{teamId:l.id,teamName:l.teamName,p1Seconds:K(u)?u:null,p2Seconds:K(o)?o:null,teamSeconds:d?st(d):null,p1Kills:i,p2Kills:y,teamKills:i+y,p1Deaths:g,p2Deaths:I,teamDeaths:g+I,rank:null,points:0}}),s=e.filter(l=>l.teamSeconds!=null).map(l=>({...l,teamSeconds:l.teamSeconds}));s.sort((l,d)=>l.teamSeconds-d.teamSeconds);const r=new Map,c=new Map,_=s.length;if(_>0){if(s.forEach((l,d)=>r.set(l.teamId,d+1)),f.value==="table")s.forEach((l,d)=>c.set(l.teamId,q.value[d]??0));else if(f.value==="percentile"){const l=N(F.value,0,999999),d=N(B.value,0,999999),u=Math.min(l,d),o=Math.max(l,d);let i=0;for(;i<_;){const y=s[i].teamSeconds;let g=i;for(;g+1<_&&s[g+1].teamSeconds===y;)g++;const I=(i+g)/2;let b;if(_===1)b=o;else{const T=(_-1-I)/(_-1);b=u+T*(o-u)}b=L(b,W.value);for(let T=i;T<=g;T++)c.set(s[T].teamId,b);i=g+1}}else{const l=G.value,d=O.value,u=s[0].teamSeconds,o=s[_-1].teamSeconds,i=Math.max(1,o-u),y=j.value,g=P.value==="fixed"?y:P.value==="auto"?i:Math.max(y,i);for(const I of s){const b=Math.max(0,I.teamSeconds-u),T=N(b/g,0,1),it=L(d-T*(d-l),W.value);c.set(I.teamId,it)}}if(f.value==="percentile"||f.value==="gap"){const l=f.value==="percentile"?Math.min(F.value,B.value):G.value,d=f.value==="percentile"?Math.max(F.value,B.value):O.value,u=nt(s.map(o=>({teamId:o.teamId,teamSeconds:o.teamSeconds})),c,{minPts:l,maxPts:d,decimals:W.value,closeWindowSeconds:tt.value});c.clear();for(const[o,i]of u.entries())c.set(o,i)}for(const l of e){const u=S.value.get(l.teamId)?.races.find(i=>i.raceId===a),o=at(u);if(o!==0){const i=c.get(l.teamId)??0;c.set(l.teamId,i+o)}}}if(Z.value){const l=e.filter(u=>u.teamSeconds==null),d=s.length;l.forEach((u,o)=>r.set(u.teamId,d+o+1))}return e.map(l=>({...l,rank:r.get(l.teamId)??null,points:c.get(l.teamId)??0})).sort((l,d)=>{const u=l.rank??Number.POSITIVE_INFINITY,o=d.rank??Number.POSITIVE_INFINITY;return u!==o?u-o:l.teamName.localeCompare(d.teamName)})}const lt=v(()=>{const a=new Map;for(const s of $.value)a.set(s.raceId,H(s.raceId));return h.teams.map(s=>{const r=$.value.map(o=>{const i=(a.get(o.raceId)??[]).find(y=>y.teamId===s.id);return{raceId:o.raceId,label:o.label,p1Seconds:i?.p1Seconds??null,p2Seconds:i?.p2Seconds??null,teamSeconds:i?.teamSeconds??null,p1Kills:i?.p1Kills??0,p2Kills:i?.p2Kills??0,teamKills:i?.teamKills??0,p1Deaths:i?.p1Deaths??0,p2Deaths:i?.p2Deaths??0,teamDeaths:i?.teamDeaths??0,rank:i?.rank??null,points:i?.points??0}}),c=r.reduce((o,i)=>o+i.points,0),_=r.reduce((o,i)=>o+i.teamKills,0),l=r.reduce((o,i)=>o+i.teamDeaths,0),d=r.map(o=>o.teamSeconds).filter(o=>o!=null&&isFinite(o)),u=d.length?d.reduce((o,i)=>o+i,0):null;return{teamId:s.id,teamName:s.teamName,player1:s.player1,player2:s.player2,totalPoints:c,totalTeamSeconds:u,totalTeamKills:_,totalTeamDeaths:l,raceBreakdown:r}}).sort((s,r)=>{if(r.totalPoints!==s.totalPoints)return r.totalPoints-s.totalPoints;const c=s.raceBreakdown.reduce((l,d)=>l+(d.rank??9999),0)/Math.max(1,s.raceBreakdown.length),_=r.raceBreakdown.reduce((l,d)=>l+(d.rank??9999),0)/Math.max(1,r.raceBreakdown.length);return c!==_?c-_:s.teamName.localeCompare(r.teamName)})}),ot=v(()=>R.value?H(R.value):[]);return(a,e)=>(m(),p("div",rt,[t("header",pt,[t("div",mt,[t("h2",null,n(et.value),1),t("p",ut,[e[2]||(e[2]=E(" Per race: team time = P1 + P2. ",-1)),f.value==="table"?(m(),p("span",ht,"F1 points table by finish.")):f.value==="percentile"?(m(),p("span",vt," Position percentile ")):(m(),p("span",_t,[E(" Gap scoring vs best time: "+n(G.value)+"–"+n(O.value)+". Window mode: ",1),t("b",null,n(P.value),1),P.value!=="auto"?(m(),p("span",ft," (fixed="+n(j.value)+"s)",1)):x("",!0),e[1]||(e[1]=E(". ",-1))]))])]),t("div",gt,[t("button",{class:Y(["chip",{active:k.value.kind==="combined"}]),onClick:e[0]||(e[0]=s=>k.value={kind:"combined"})}," Combined ",2),(m(!0),p(w,null,V($.value,s=>(m(),p("button",{key:s.raceId,class:Y(["chip",{active:k.value.kind==="race"&&k.value.raceId===s.raceId}]),onClick:r=>k.value={kind:"race",raceId:s.raceId}},n(s.label),11,bt))),128))])]),t("div",yt,[t("table",kt,[t("thead",null,[t("tr",null,[e[9]||(e[9]=t("th",{class:"col-rank"},"#",-1)),e[10]||(e[10]=t("th",{class:"col-team"},"Team",-1)),e[11]||(e[11]=t("th",{class:"col-players"},"Players",-1)),k.value.kind==="combined"?(m(),p(w,{key:0},[t("th",It,n(z.value),1),e[3]||(e[3]=t("th",{class:"col-stat"},"Team Checks",-1)),e[4]||(e[4]=t("th",{class:"col-stat"},"Team Deaths",-1)),e[5]||(e[5]=t("th",{class:"col-time"},"Total Time",-1))],64)):(m(),p(w,{key:1},[e[6]||(e[6]=t("th",{class:"col-time"},"Team Time",-1)),t("th",St,n(z.value),1),e[7]||(e[7]=t("th",{class:"col-stat"},"Team Checks",-1)),e[8]||(e[8]=t("th",{class:"col-stat"},"Team Deaths",-1))],64)),e[12]||(e[12]=t("th",{class:"col-actions"},null,-1))])]),k.value.kind==="combined"?(m(),p("tbody",Mt,[(m(!0),p(w,null,V(lt.value,(s,r)=>(m(),p(w,{key:s.teamId},[t("tr",{class:Y(["row",{expanded:D.value===s.teamId}])},[t("td",Tt,n(r+1),1),t("td",xt,[t("div",wt,n(s.teamName),1)]),t("td",Pt,[t("div",Dt,[t("div",Nt,[t("span",Ct,n(s.player1.name),1),M(s.player1.twitch)?(m(),p("a",{key:0,class:"twitch",href:M(s.player1.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,Kt)):x("",!0)]),t("div",Wt,[t("span",Ft,n(s.player2.name),1),M(s.player2.twitch)?(m(),p("a",{key:0,class:"twitch",href:M(s.player2.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,Bt)):x("",!0)])])]),t("td",$t,[t("span",Rt,n(X(s.totalPoints)),1)]),t("td",Lt,n(s.totalTeamKills),1),t("td",At,n(s.totalTeamDeaths),1),t("td",Et,n(C(s.totalTeamSeconds)),1),t("td",Vt,[t("button",{class:"btn",onClick:c=>U(s.teamId)},n(D.value===s.teamId?"Hide":"Details"),9,Gt)])],2),D.value===s.teamId?(m(),p("tr",Ot,[t("td",jt,[t("div",zt,[e[33]||(e[33]=t("div",{class:"details-head"},[t("div",{class:"dh-title"},"Race breakdown"),t("div",{class:"dh-sub"},"Shows per-player and team totals each race.")],-1)),t("div",Xt,[t("table",Yt,[t("thead",null,[t("tr",qt,[e[17]||(e[17]=t("th",{class:"col-race",rowspan:"2"},"Race",-1)),t("th",Ht,[t("div",Jt,[e[13]||(e[13]=t("span",{class:"grp-dot p1"},null,-1)),t("span",Qt,n(s.player1.name),1),e[14]||(e[14]=t("span",{class:"grp-tag"},"P1",-1))])]),t("th",Ut,[t("div",Zt,[e[15]||(e[15]=t("span",{class:"grp-dot p2"},null,-1)),t("span",te,n(s.player2.name),1),e[16]||(e[16]=t("span",{class:"grp-tag"},"P2",-1))])]),e[18]||(e[18]=t("th",{class:"grp team",colspan:"5"},[t("div",{class:"grp-title"},[t("span",{class:"grp-dot team"}),t("span",{class:"grp-name"},"Team")])],-1))]),t("tr",ee,[e[19]||(e[19]=t("th",{class:"col-time"},"Time",-1)),e[20]||(e[20]=t("th",{class:"col-stat"},"Checks",-1)),e[21]||(e[21]=t("th",{class:"col-stat"},"Deaths",-1)),e[22]||(e[22]=t("th",{class:"col-time"},"Time",-1)),e[23]||(e[23]=t("th",{class:"col-stat"},"Checks",-1)),e[24]||(e[24]=t("th",{class:"col-stat"},"Deaths",-1)),e[25]||(e[25]=t("th",{class:"col-time"},"Time",-1)),e[26]||(e[26]=t("th",{class:"col-stat"},"Checks",-1)),e[27]||(e[27]=t("th",{class:"col-stat"},"Deaths",-1)),e[28]||(e[28]=t("th",{class:"col-rank"},"Rank",-1)),t("th",se,n(z.value),1)])]),t("tbody",null,[(m(!0),p(w,null,V(s.raceBreakdown,c=>(m(),p("tr",{key:c.raceId,class:"rrow"},[t("td",ae,n(c.label),1),t("td",ne,n(C(c.p1Seconds)),1),t("td",le,n(c.p1Kills),1),t("td",oe,n(c.p1Deaths),1),t("td",ie,n(C(c.p2Seconds)),1),t("td",ce,n(c.p2Kills),1),t("td",de,n(c.p2Deaths),1),t("td",re,[t("b",null,n(C(c.teamSeconds)),1)]),t("td",pe,[t("b",null,n(c.teamKills),1)]),t("td",me,[t("b",null,n(c.teamDeaths),1)]),t("td",ue,n(c.rank??"—"),1),t("td",he,[t("b",null,n(X(c.points)),1)])]))),128))])])]),t("div",ve,[e[32]||(e[32]=t("div",{class:"leg-item"},[t("span",{class:"dot"}),t("span",null,"Missing/DNF times score 0")],-1)),f.value==="table"?(m(),p("div",_e,[e[29]||(e[29]=t("span",{class:"dot"},null,-1)),t("span",null,"Points table: "+n(q.value.join(", ")),1)])):f.value==="percentile"?(m(),p("div",fe,[e[30]||(e[30]=t("span",{class:"dot"},null,-1)),t("span",null,"Percentile range: "+n(F.value)+"–"+n(B.value)+" (ties share score)",1)])):(m(),p("div",ge,[e[31]||(e[31]=t("span",{class:"dot"},null,-1)),t("span",null,[E(" Gap vs best time. Window mode: "+n(P.value)+" ",1),P.value!=="auto"?(m(),p("span",be," (fixed="+n(j.value)+"s)",1)):x("",!0)])]))])])])])):x("",!0)],64))),128))])):(m(),p("tbody",ye,[(m(!0),p(w,null,V(ot.value,s=>(m(),p("tr",{key:s.teamId,class:"row"},[t("td",ke,n(s.rank??"—"),1),t("td",Ie,[t("div",Se,n(s.teamName),1)]),t("td",Me,[S.value.get(s.teamId)?(m(),p("div",Te,[t("div",xe,[t("span",we,n(S.value.get(s.teamId).player1.name),1),M(S.value.get(s.teamId).player1.twitch)?(m(),p("a",{key:0,class:"twitch",href:M(S.value.get(s.teamId).player1.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,Pe)):x("",!0)]),t("div",De,[t("span",Ne,n(S.value.get(s.teamId).player2.name),1),M(S.value.get(s.teamId).player2.twitch)?(m(),p("a",{key:0,class:"twitch",href:M(S.value.get(s.teamId).player2.twitch),target:"_blank",rel:"noopener"}," Twitch ",8,Ce)):x("",!0)])])):(m(),p("div",Ke,e[34]||(e[34]=[t("div",{class:"player"},[t("span",{class:"pname"},"—")],-1),t("div",{class:"player"},[t("span",{class:"pname"},"—")],-1)])))]),t("td",We,[t("b",null,n(C(s.teamSeconds)),1)]),t("td",Fe,[t("span",Be,n(X(s.points)),1)]),t("td",$e,n(s.teamKills),1),t("td",Re,n(s.teamDeaths),1),e[35]||(e[35]=t("td",{class:"cell-actions"},null,-1))]))),128))]))])])]))}}),Ee=dt(Le,[["__scopeId","data-v-d451b1a0"]]);export{Ee as T};
