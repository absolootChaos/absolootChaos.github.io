import{d as Ce,c as p,r as c,q as K,h as ke,g as be,s as Ye,a as s,b as l,l as le,f as m,j as T,t as d,k as P,v as Je,u as ee,F as b,e as R,x as ye,i as Ge,n as te,T as Xe,m as xe,w as _e,y as we,o,_ as Se,z as Qe,R as Ze}from"./index-Cb5kvp5K.js";import{P as et}from"./Map.vue_vue_type_style_index_0_scoped_5aedbda8_lang-ClaoCoz3.js";const tt={class:"map-wrap"},at={class:"topbar"},lt={class:"left"},nt={class:"title"},st={class:"title-text"},ot={class:"sub"},it={key:0},rt={class:"controls"},ut=["value"],dt=["value"],ct=["value"],vt={class:"toggle"},ft={key:0,class:"placement-hint"},pt={key:0,class:"copied"},mt={class:"right"},gt={key:0,class:"status"},ht={key:1,class:"status error"},kt={class:"panzoom-root"},yt=["src"],_t={key:0,class:"route-svg",viewBox:"0 0 100 100",preserveAspectRatio:"none"},wt=["points"],Ct=["title"],bt=["onClick","title"],xt={class:"legend"},St={key:0,class:"legend-row"},Mt={key:0,class:"drawer"},$t={key:0,class:"route-panel"},It={class:"route-head"},Pt={class:"route-sub"},Rt={class:"toggle route-toggle"},Ft={class:"route-list"},Et=["onClick"],Nt={class:"idx"},Vt={class:"name"},jt={key:0,class:"locmark"},zt={key:0,class:"loc"},Lt={key:1,class:"tag kindling"},At={key:2,class:"tag done"},Tt={class:"drawer-head"},Bt={class:"drawer-title"},Dt={class:"name"},Ot={key:0,class:"loc"},Ut={class:"drawer-body"},Kt={class:"pill-row"},Wt={key:0,class:"pill"},qt={key:0,class:"desc"},Ht={class:"actions"},Yt={key:1,class:"note"},Jt={key:2,class:"drawer-head"},Gt={class:"drawer-title"},Xt={class:"loc"},ae=1,Qt="/data/dlcRoutes.json",Zt=Ce({__name:"Map",props:{mapSrc:{},dataUrl:{default:"/data/dlcChecks.json"},checks:{default:void 0},startPlacementMode:{type:Boolean,default:!1},categoryOrder:{default:void 0},maxScale:{default:5},minScale:{default:.4},startShrink:{default:1},fitPadding:{default:0},startYOffset:{default:650}},setup(ne){const h=ne,S=p(()=>{const a=(h.mapSrc||"map").replace(/[^a-z0-9_-]/gi,"_");return`dlcChecksProgress:v${ae}:${a}:${x.value}`});function B(){try{const a=localStorage.getItem(S.value);if(!a)return null;const e=JSON.parse(a);return!e||e.v!==ae||!e.checks?null:e}catch{return null}}function D(){try{const a={v:ae,updatedAt:Date.now(),checks:Object.fromEntries(r.value.filter(e=>!v(e)).map(e=>[e.id,{done:!!e.done,kindling:!!e.kindling}]))};localStorage.setItem(S.value,JSON.stringify(a))}catch{}}function se(){const a=B();if(!a)return;const e=a.checks;r.value=r.value.map(t=>{if(v(t))return t;const n=e[t.id];return n?{...t,done:!!n.done,kindling:!!n.kindling}:t})}function Me(){try{localStorage.removeItem(S.value)}catch{}r.value=r.value.map(a=>v(a)?a:{...a,done:!1,kindling:!1})}const oe=c([{id:"all",label:"All Checks",url:""},{id:"defaultSeed",label:"Default Checks",url:"/data/dlcSeeds/default.json"},{id:"seed2",label:"Seed 2 Checklist",url:"/data/dlcSeeds/seed2.json"},{id:"seed1",label:"Seed 1 Checklist",url:"/data/dlcSeeds/seed1.json"}]),x=c("seed1"),M=c(null),F=c(!0),O=c([]),E=c(""),k=p(()=>O.value.find(a=>a.routeId===E.value)??null),$e=p(()=>k.value?F.value?w.value:w.value.filter(a=>!v(a)):[]),Ie=p(()=>!k.value||!F.value?[]:w.value.filter(a=>v(a))),N=c(null),ie=c(null),V=c(null),W=c(!1),j=c(""),r=c([]),y=c(null),q=c(!!h.startPlacementMode),H=c(""),Y=c(""),U=c("all"),J=c(!0);let i=null,z=null,L=0;const G=c(null);function v(a){return(a.category||"").toLowerCase()==="location"}async function Pe(){j.value="",W.value=!0;try{if(h.checks?.length){r.value=h.checks.map(n=>({...n,done:!!n.done,kindling:!!n.kindling}));return}const a=await fetch(h.dataUrl,{cache:"no-store"});if(!a.ok)throw new Error(`Failed to load checks: ${a.status}`);const e=await a.json(),t=Array.isArray(e)?e:e.checks;r.value=(t||[]).map(n=>({...n,done:!!n.done,kindling:!!n.kindling})),se()}catch(a){j.value=a?.message??"Failed to load checks."}finally{W.value=!1}}K(x,async()=>{await X(),y.value=null,se()});let $=null;function Re(){$&&window.clearTimeout($),$=window.setTimeout(()=>{$=null,D()},250)}K(r,()=>{Re()},{deep:!0}),ke(()=>{$&&window.clearTimeout($)});async function X(){M.value=null;const a=oe.value.find(e=>e.id===x.value);if(!(!a||!a.url))try{const e=await fetch(a.url,{cache:"no-store"});if(!e.ok)throw new Error(`Failed to load seed list: ${e.status}`);M.value=await e.json()}catch(e){j.value=e?.message??"Failed to load seed list."}}async function Fe(){try{const a=await fetch(Qt,{cache:"no-store"});if(!a.ok)throw new Error(`Failed to load routes: ${a.status}`);const e=await a.json();O.value=Array.isArray(e)?e:e.routes}catch(a){console.warn(a?.message??"Failed to load routes"),O.value=[]}}const re=p(()=>{if(x.value==="all"||!M.value)return r.value;const a=new Set(M.value.checkIds),e=r.value.filter(f=>a.has(f.id)),t=M.value.defaultCount;if(!t||e.length<=t)return e;const n=new Map(e.map(f=>[f.id,f]));return M.value.checkIds.map(f=>n.get(f)).filter(Boolean).slice(0,t)}),I=p(()=>re.value.filter(a=>!v(a)));p(()=>re.value.filter(a=>v(a)));const Ee=p(()=>{const a=new Set;for(const n of I.value)n.category&&a.add(n.category);const e=Array.from(a).sort((n,u)=>n.localeCompare(u));if(!h.categoryOrder?.length)return e;const t=h.categoryOrder.filter(n=>a.has(n));for(const n of e)t.includes(n)||t.push(n);return t}),Q=p(()=>{const a=Y.value.trim().toLowerCase();return I.value.filter(e=>!J.value&&(e.done||e.kindling)||U.value!=="all"&&(e.category||"")!==U.value?!1:a?`${e.name} ${e.locationName??""} ${e.description??""}`.toLowerCase().includes(a):!0)}),Ne=p(()=>I.value.filter(a=>a.done||a.kindling).length),w=p(()=>{const a=k.value;if(!a)return[];const e=new Map(r.value.map(t=>[t.id,t]));return a.checkIds.map(t=>e.get(t)).filter(Boolean)}),Ve=p(()=>w.value.map(a=>`${a.x},${a.y}`).join(" ")),je=p(()=>k.value?w.value.filter(a=>!v(a)):Q.value);p(()=>k.value?w.value.filter(a=>v(a)):[]);const g=p(()=>y.value?r.value.find(a=>a.id===y.value)??null:null);function ue(a){y.value=a}function de(){y.value=null,E.value=""}function ze(a){const e=r.value.findIndex(t=>t.id===a);e!==-1&&(v(r.value[e])||(r.value[e]={...r.value[e],done:!r.value[e].done}))}function Le(a){const e=r.value.findIndex(n=>n.id===a);if(e===-1||v(r.value[e]))return;const t=r.value[e];r.value[e]={...t,kindling:!t.kindling}}const Ae=p(()=>I.value.filter(a=>!!a.kindling).length);function Te(a){const e=V.value;if(!e)return null;const t=e.getBoundingClientRect(),n=(a.clientX-t.left)/t.width,u=(a.clientY-t.top)/t.height,f=Math.max(0,Math.min(100,n*100)),_=Math.max(0,Math.min(100,u*100));return{x:f,y:_}}async function Be(a){if(!q.value)return;const e=Te(a);if(!e)return;const t=`{ "x": ${e.x.toFixed(2)}, "y": ${e.y.toFixed(2)} }`;H.value=t;try{await navigator.clipboard.writeText(t)}catch{}}function Z(a){const e=N.value,t=V.value;if(!i||!e||!t||a!==L)return;const n=e.getBoundingClientRect(),u=t.getBoundingClientRect();let f=0,_=0;if(u.left>n.left&&(f=n.left-u.left),u.right<n.right&&(f=n.right-u.right),u.top>n.top&&(_=n.top-u.top),u.bottom<n.bottom&&(_=n.bottom-u.bottom),f!==0||_!==0){const A=i.getPan();i.pan(A.x+f,A.y+_,{relative:!1,force:!0,animate:!1})}}function ce(a=!0,e=!0){const t=V.value,n=N.value;if(!i||!t||!n)return;const u=++L,f=t.naturalWidth||1,_=t.naturalHeight||1,A=n.getBoundingClientRect(),fe=Math.max(1,A.width),pe=Math.max(1,A.height),Ue=Math.max(fe/f,pe/_);i.pan(0,0,{relative:!1,force:!0,animate:!1});const me=i.getScale();me!==1&&i.zoom(1/me,{force:!0,animate:!1}),i.zoom(Ue/i.getScale(),{force:!0,animate:!1});const ge=i.getScale(),Ke=f*ge,We=_*ge;let qe=(fe-Ke)/2,He=(pe-We)/2;i.pan(Math.round(qe),Math.round(He),{relative:!1,force:!0,animate:!1}),requestAnimationFrame(()=>{if(u!==L)return;Z(u);const he=h.startYOffset??0;if(he){const C=i.getPan();i.pan(C.x,C.y-he,{relative:!1,force:!0,animate:!1})}requestAnimationFrame(()=>{u===L&&(Z(u),requestAnimationFrame(()=>{if(u===L){if(Z(u),e){const C=i.getPan();G.value={scale:i.getScale(),x:C.x,y:C.y}}if(a){const C=i.getPan();i.pan(C.x,C.y,{relative:!1,force:!0,animate:!0})}}}))})})}function De(){if(!i||!G.value){ce(!0,!0);return}const a=G.value,e=a.scale/i.getScale();i.zoom(e,{force:!0,animate:!0}),i.pan(a.x,a.y,{relative:!1,force:!0,animate:!0})}function Oe(){const a=ie.value,e=N.value;!a||!e||(ve(),i=et(a,{maxScale:h.maxScale,minScale:h.minScale,contain:void 0,cursor:"grab"}),z=t=>{i&&(t.ctrlKey||(t.preventDefault(),i.zoomWithWheel(t)))},e.addEventListener("wheel",z,{passive:!1}))}function ve(){const a=N.value;if(a&&z&&a.removeEventListener("wheel",z),z=null,i){try{i.destroy()}catch{}i=null}}return K(x,async()=>{await X(),y.value=null}),K(E,()=>{y.value=null}),be(async()=>{await Pe(),await X(),await Fe(),await Ye(),Oe();const a=V.value;if(!a)return;const e=()=>{ce(!1,!0),requestAnimationFrame(()=>De())};a.complete?e():a.addEventListener("load",e,{once:!0})}),ke(()=>{ve()}),(a,e)=>(o(),s("div",tt,[l("div",at,[l("div",lt,[l("div",nt,[e[10]||(e[10]=l("span",{class:"spark"},"üß≠",-1)),l("div",st,[e[9]||(e[9]=l("div",{class:"h1"},"DLC Checks Map (WIP)",-1)),l("div",ot,[T(d(Ne.value)+"/"+d(I.value.length)+" completed ‚Ä¢ üî• "+d(Ae.value)+" Kindling Shards ",1),Q.value.length!==I.value.length?(o(),s("span",it," ‚Ä¢ showing "+d(Q.value.length),1)):m("",!0)])])]),l("div",rt,[P(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>Y.value=t),class:"input",type:"text",placeholder:"Search checks‚Ä¶"},null,512),[[Je,Y.value]]),P(l("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>x.value=t),class:"select"},[(o(!0),s(b,null,R(oe.value,t=>(o(),s("option",{key:t.id,value:t.id},d(t.label),9,ut))),128))],512),[[ee,x.value]]),P(l("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>U.value=t),class:"select"},[e[11]||(e[11]=l("option",{value:"all"},"All categories",-1)),(o(!0),s(b,null,R(Ee.value,t=>(o(),s("option",{key:t,value:t},d(t),9,dt))),128))],512),[[ee,U.value]]),l("button",{class:"btn",onClick:Me,title:"Clear saved progress"}," Clear Progress "),P(l("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>E.value=t),class:"select"},[e[12]||(e[12]=l("option",{value:""},"No route (show all)",-1)),(o(!0),s(b,null,R(O.value,t=>(o(),s("option",{key:t.routeId,value:t.routeId},d(t.label),9,ct))),128))],512),[[ee,E.value]]),l("label",vt,[P(l("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>J.value=t),type:"checkbox"},null,512),[[ye,J.value]]),e[13]||(e[13]=l("span",null,"Show completed",-1))])]),q.value?(o(),s("div",ft,[e[14]||(e[14]=l("b",null,"Placement mode:",-1)),e[15]||(e[15]=T(" click the map to copy coordinates. ",-1)),H.value?(o(),s("span",pt,"Copied: "+d(H.value),1)):m("",!0)])):m("",!0)]),l("div",mt,[W.value?(o(),s("div",gt,"Loading checks‚Ä¶")):j.value?(o(),s("div",ht,"‚ùå "+d(j.value),1)):m("",!0)])]),l("div",{ref_key:"containerEl",ref:N,class:te(["map-viewport",{placing:q.value}]),onClick:Be},[l("div",kt,[l("div",{ref_key:"panzoomEl",ref:ie,class:"map-layer"},[l("img",{ref_key:"imgEl",ref:V,class:"map-img",src:a.mapSrc,alt:"DLC map"},null,8,yt),k.value&&w.value.length>=2?(o(),s("svg",_t,[l("polyline",{class:"route-line",points:Ve.value},null,8,wt)])):m("",!0),(o(!0),s(b,null,R(Ie.value,t=>(o(),s("button",{key:t.id,class:"waypoint",style:we({left:t.x+"%",top:t.y+"%"}),onClick:e[5]||(e[5]=_e(()=>{},["stop"])),title:t.name}," ‚õ≥ ",12,Ct))),128)),(o(!0),s(b,null,R(je.value,t=>(o(),s("button",{key:t.id,class:te(["pin",{done:!!t.done,kindling:!!t.kindling,selected:y.value===t.id,inRoute:!!k.value}]),style:we({left:t.x+"%",top:t.y+"%"}),onClick:_e(n=>ue(t.id),["stop"]),title:t.locationName?`${t.name} ‚Äî ${t.locationName}`:t.name},e[16]||(e[16]=[l("span",{class:"dot"},null,-1)]),14,bt))),128))],512)]),l("div",xt,[e[18]||(e[18]=Ge('<div class="legend-row" data-v-5aedbda8><span class="legend-dot" data-v-5aedbda8></span><span data-v-5aedbda8>Incomplete</span></div><div class="legend-row" data-v-5aedbda8><span class="legend-dot done" data-v-5aedbda8></span><span data-v-5aedbda8>Completed</span></div><div class="legend-row" data-v-5aedbda8><span class="legend-dot kindling" data-v-5aedbda8></span><span data-v-5aedbda8>Kindling</span></div>',3)),k.value&&F.value?(o(),s("div",St,e[17]||(e[17]=[l("span",{class:"legend-flag"},"‚õ≥",-1),l("span",null,"Route waypoint",-1)]))):m("",!0)])],2),le(Xe,{name:"slide"},{default:xe(()=>[g.value||k.value?(o(),s("aside",Mt,[k.value?(o(),s("div",$t,[l("div",It,[e[20]||(e[20]=l("div",{class:"route-title"},"Route",-1)),l("div",Pt,d(k.value.label)+" ‚Ä¢ "+d(w.value.length)+" items",1),l("label",Rt,[P(l("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>F.value=t),type:"checkbox"},null,512),[[ye,F.value]]),e[19]||(e[19]=l("span",null,"Show locations",-1))])]),l("ol",Ft,[(o(!0),s(b,null,R($e.value,(t,n)=>(o(),s("li",{key:t.id,class:te(["route-item",{isLocation:v(t),active:y.value===t.id}]),onClick:u=>ue(t.id)},[l("span",Nt,d(n+1),1),l("span",Vt,[v(t)?(o(),s("span",jt,"‚õ≥")):m("",!0),T(" "+d(t.name),1)]),t.locationName?(o(),s("span",zt,"‚Äî "+d(t.locationName),1)):m("",!0),!v(t)&&t.kindling?(o(),s("span",Lt,"Kindling")):!v(t)&&t.done?(o(),s("span",At,"Done")):m("",!0)],10,Et))),128))])])):m("",!0),g.value?(o(),s(b,{key:1},[l("div",Tt,[l("div",Bt,[l("div",Dt,d(g.value.name),1),g.value.locationName?(o(),s("div",Ot,d(g.value.locationName),1)):m("",!0)]),l("button",{class:"icon-btn",onClick:de,"aria-label":"Close"},"‚úï")]),l("div",Ut,[l("div",Kt,[g.value.category?(o(),s("span",Wt,d(g.value.category),1)):m("",!0)]),g.value.description?(o(),s("p",qt,d(g.value.description),1)):m("",!0),l("div",Ht,[v(g.value)?m("",!0):(o(),s(b,{key:0},[l("button",{class:"btn primary",onClick:e[7]||(e[7]=t=>ze(g.value.id))},d(g.value.done?"Mark incomplete":"Mark complete"),1),l("button",{class:"btn kindling",onClick:e[8]||(e[8]=t=>Le(g.value.id))},d(g.value.kindling?"Remove kindling":"Mark as Kindling"),1)],64))]),v(g.value)?(o(),s("div",Yt,e[21]||(e[21]=[l("b",null,"Waypoint:",-1),T(" This is a route marker only. It doesn‚Äôt count toward completion. ",-1)]))):m("",!0)])],64)):(o(),s("div",Jt,[l("div",Gt,[e[22]||(e[22]=l("div",{class:"name"},"Route",-1)),l("div",Xt,d(k.value?.label),1)]),l("button",{class:"icon-btn",onClick:de,"aria-label":"Close"},"‚úï")]))])):m("",!0)]),_:1})]))}}),ea=Se(Zt,[["__scopeId","data-v-5aedbda8"]]),ta={class:"map-page"},aa={class:"topbar"},la={key:0,class:"loading"},na={key:1,class:"map-wrap"},sa=Ce({__name:"MapPage",setup(ne){const h=c([]),S=c(!0);return be(async()=>{try{const B=await fetch("/data/dlcChecks.json",{cache:"no-store"});h.value=await B.json()}finally{S.value=!1}}),(B,D)=>(o(),s("div",ta,[l("header",aa,[le(Qe(Ze),{to:"/",class:"home-btn"},{default:xe(()=>D[0]||(D[0]=[T(" ‚Üê Home ",-1)])),_:1,__:[0]})]),S.value?(o(),s("div",la,"Loading map‚Ä¶")):(o(),s("div",na,[le(ea,{class:"map-component","map-src":"/img/testt2.jpg","data-url":"/data/dlcChecks.json"})]))]))}}),ra=Se(sa,[["__scopeId","data-v-7a47ff6a"]]);export{ra as default};
